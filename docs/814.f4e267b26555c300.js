"use strict";(self.webpackChunkng_football=self.webpackChunkng_football||[]).push([[814],{1850:(Cf,ss,y)=>{y.r(ss),y.d(ss,{LeagueModule:()=>yf});var we=y(6814),An=y(7045),l=y(5879);let Ua=(()=>{class n{ngOnInit(){}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275cmp=l.Xpm({type:n,selectors:[["app-league"]],decls:11,vars:0,consts:[[1,"navbar","navbar-expand-lg","navbar-expand-sm","navbar-light","bg-light"],["src","https://static.posters.cz/image/hp/77610.jpg",2,"max-width","200px","float","left","margin-left","3px"],["id","navbarSupportedContent",1,"navbar-collapse","align-items-center","justify-content-start"],[1,"navbar-nav","mr-auto","text-center"],[1,"nav-item"],["href","#/calendar",1,"nav-link"],["href","#/classement",1,"nav-link"]],template:function(i,s){1&i&&(l.TgZ(0,"nav",0),l._UZ(1,"img",1),l.TgZ(2,"div",2)(3,"ul",3)(4,"li",4)(5,"a",5),l._uU(6,"Matchs"),l.qZA()(),l.TgZ(7,"li",4)(8,"a",6),l._uU(9,"Classement"),l.qZA()()()()(),l._UZ(10,"router-outlet"))},dependencies:[An.lC],styles:[".nav-item[_ngcontent-%COMP%]{font-size:20px;min-width:150px;min-height:2em;text-align:center}"]})}return n})();var rs=y(8645),os=y(9773),as=y(2096),ls=y(9862),se=y(8326),Mt=y(7217),re=y(7213),oe=y(7398),Wa=y(3020),cs=y(6699),us=y(9360),xt=y(8251),hs=y(4829),Ha=y(2737),ja=y(2420),ds=y(4564),fs=y(4664),Qa=y(3997),$a=y(6321),ps=y(5592),_s=y(3019),za=(y(999),y(3106)),Ee=y(4537),Ka=y(5861),Ot=y(534),u=y(9058),Tn=y(7879);const gs="@firebase/database";let In="";function Dn(n){In=n}class Za{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),(0,u.Wl)(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:(0,u.cI)(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}class Ja{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return(0,u.r3)(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}const ys=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const t=window[n];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Za(t)}}catch{}return new Ja},be=ys("localStorage"),Nn=ys("sessionStorage"),Ve=new Tn.Yd("@firebase/database"),vs=function(){let n=1;return function(){return n++}}(),Cs=function(n){const t=(0,u.dS)(n),e=new u.gQ;e.update(t);const i=e.digest();return u.US.encodeByteArray(i)},Ze=function(...n){let t="";for(let e=0;e<n.length;e++){const i=n[e];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=Ze.apply(null,i):t+="object"==typeof i?(0,u.Wl)(i):i,t+=" "}return t};let Se=null,ws=!0;const Es=function(n,t){(0,u.hu)(!t||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(Ve.logLevel=Tn.in.VERBOSE,Se=Ve.log.bind(Ve),t&&Nn.set("logging_enabled",!0)):"function"==typeof n?Se=n:(Se=null,Nn.remove("logging_enabled"))},M=function(...n){if(!0===ws&&(ws=!1,null===Se&&!0===Nn.get("logging_enabled")&&Es(!0)),Se){const t=Ze.apply(null,n);Se(t)}},Je=function(n){return function(...t){M(n,...t)}},Mn=function(...n){const t="FIREBASE INTERNAL ERROR: "+Ze(...n);Ve.error(t)},z=function(...n){const t=`FIREBASE FATAL ERROR: ${Ze(...n)}`;throw Ve.error(t),new Error(t)},R=function(...n){const t="FIREBASE WARNING: "+Ze(...n);Ve.warn(t)},Pt=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},ae="[MIN_NAME]",te="[MAX_NAME]",Ae=function(n,t){if(n===t)return 0;if(n===ae||t===te)return-1;if(t===ae||n===te)return 1;{const e=As(n),i=As(t);return null!==e?null!==i?e-i==0?n.length-t.length:e-i:-1:null!==i?1:n<t?-1:1}},tl=function(n,t){return n===t?0:n<t?-1:1},Xe=function(n,t){if(t&&n in t)return t[n];throw new Error("Missing required key ("+n+") in object: "+(0,u.Wl)(t))},xn=function(n){if("object"!=typeof n||null===n)return(0,u.Wl)(n);const t=[];for(const i in n)t.push(i);t.sort();let e="{";for(let i=0;i<t.length;i++)0!==i&&(e+=","),e+=(0,u.Wl)(t[i]),e+=":",e+=xn(n[t[i]]);return e+="}",e},bs=function(n,t){const e=n.length;if(e<=t)return[n];const i=[];for(let s=0;s<e;s+=t)i.push(n.substring(s,s+t>e?e:s+t));return i};function x(n,t){for(const e in n)n.hasOwnProperty(e)&&t(e,n[e])}const Ss=function(n){(0,u.hu)(!Pt(n),"Invalid JSON number");const i=1023;let s,r,o,a,c;0===n?(r=0,o=0,s=1/n==-1/0?1:0):(s=n<0,(n=Math.abs(n))>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,52-a)-Math.pow(2,52))):(r=0,o=Math.round(n/Math.pow(2,-1074))));const h=[];for(c=52;c;c-=1)h.push(o%2?1:0),o=Math.floor(o/2);for(c=11;c;c-=1)h.push(r%2?1:0),r=Math.floor(r/2);h.push(s?1:0),h.reverse();const d=h.join("");let f="";for(c=0;c<64;c+=8){let p=parseInt(d.substr(c,8),2).toString(16);1===p.length&&(p="0"+p),f+=p}return f.toLowerCase()},rl=new RegExp("^-?(0*)\\d{1,10}$"),As=function(n){if(rl.test(n)){const t=Number(n);if(t>=-2147483648&&t<=2147483647)return t}return null},Fe=function(n){try{n()}catch(t){setTimeout(()=>{throw R("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}},et=function(n,t){const e=setTimeout(n,t);return"number"==typeof e&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(e):"object"==typeof e&&e.unref&&e.unref(),e};class cl{constructor(t,e){this.appName_=t,this.appCheckProvider=e,this.appCheck=e?.getImmediate({optional:!0}),this.appCheck||e?.get().then(i=>this.appCheck=i)}getToken(t){return this.appCheck?this.appCheck.getToken(t):new Promise((e,i)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then(i=>i.addTokenListener(t))}notifyForInvalidToken(){R(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class ul{constructor(t,e,i){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(e=>e&&"auth/token-not-initialized"===e.code?(M("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,i)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';t+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',R(t)}}let tt=(()=>{class n{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const Ms=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Ps="websocket",Rs="long_polling";class Pn{constructor(t,e,i,s,r=!1,o="",a=!1,c=!1){this.secure=e,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=be.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&be.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function ks(n,t,e){let i;if((0,u.hu)("string"==typeof t,"typeof type must == string"),(0,u.hu)("object"==typeof e,"typeof params must == object"),t===Ps)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(t!==Rs)throw new Error("Unknown connection type: "+t);i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function hl(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(e.ns=n.namespace);const s=[];return x(e,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}class dl{constructor(){this.counters_={}}incrementCounter(t,e=1){(0,u.r3)(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return(0,u.p$)(this.counters_)}}const Rn={},kn={};function Vn(n){const t=n.toString();return Rn[t]||(Rn[t]=new dl),Rn[t]}class pl{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Fe(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class le{constructor(t,e,i,s,r,o,a){this.connId=t,this.repoInfo=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Je(t),this.stats_=Vn(e),this.urlFn=c=>(this.appCheckToken&&(c.ac=this.appCheckToken),ks(e,Rs,c))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new pl(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if((0,u.Yr)()||"complete"===document.readyState)n();else{let t=!1;const e=function(){document.body?t||(t=!0,n()):setTimeout(e,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&e()}),window.attachEvent("onload",e))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Fn((...r)=>{const[o,a,c,h,d]=r;if(this.incrementIncomingBytes_(r),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===o)this.id=a,this.password=c;else{if("close"!==o)throw new Error("Unrecognized command received: "+o);a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_()}},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={start:"t"};i.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(i.cb=this.scriptTagHolder.uniqueCallbackIdentifier),i.v="5",this.transportSessionId&&(i.s=this.transportSessionId),this.lastSessionId&&(i.ls=this.lastSessionId),this.applicationId&&(i.p=this.applicationId),this.appCheckToken&&(i.ac=this.appCheckToken),typeof location<"u"&&location.hostname&&Ms.test(location.hostname)&&(i.r="f");const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){le.forceAllow_=!0}static forceDisallow(){le.forceDisallow_=!0}static isAvailable(){return!((0,u.Yr)()||!le.forceAllow_&&(le.forceDisallow_||!(typeof document<"u")||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=(0,u.Wl)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const i=(0,u.h$)(e),s=bs(i,1840);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if((0,u.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const i={dframe:"t"};i.id=t,i.pw=e,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=(0,u.Wl)(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Fn{constructor(t,e,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,u.Yr)())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=vs(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=Fn.createIFrame_();let r="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){M("frame writing exception"),a.stack&&M(a.stack),M(a)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||M("No IE domain setting required")}catch{const i=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;let e=this.urlFn(t),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+i.length<=1870;){const o=this.pendingSegs.shift();i=i+"&seg"+s+"="+o.seg+"&ts"+s+"="+o.ts+"&d"+s+"="+o.d,s++}return e+=i,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,i){this.pendingSegs.push({seg:t,ts:e,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const i=()=>{this.outstandingRequests.delete(e),this.newRequest_()},s=setTimeout(i,Math.floor(25e3));this.addTag(t,()=>{clearTimeout(s),i()})}addTag(t,e){(0,u.Yr)()?this.doNodeLongPoll(t,e):setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||"loaded"===s||"complete"===s)&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),e())},i.onerror=()=>{M("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}let kt=null;typeof MozWebSocket<"u"?kt=MozWebSocket:typeof WebSocket<"u"&&(kt=WebSocket);let Le=(()=>{class n{constructor(e,i,s,r,o,a,c){this.connId=e,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Je(this.connId),this.stats_=Vn(i),this.connURL=n.connectionURL_(i,a,c,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(e,i,s,r,o){const a={v:"5"};return!(0,u.Yr)()&&typeof location<"u"&&location.hostname&&Ms.test(location.hostname)&&(a.r="f"),i&&(a.s=i),s&&(a.ls=s),r&&(a.ac=r),o&&(a.p=o),ks(e,Ps,a)}open(e,i){this.onDisconnect=i,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,be.set("previous_websocket_failure",!0);try{let s;if((0,u.Yr)()){s={headers:{"User-Agent":`Firebase/5/${In}/${process.platform}/${this.nodeAdmin?"AdminNode":"Node"}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);const o=process.env,a=0===this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new kt(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;return r&&this.log_(r),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const s=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&null!==kt&&!n.forceDisallow_}static previouslyFailed(){return be.isInMemoryStorage||!0===be.get("previous_websocket_failure")}markConnectionHealthy(){be.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const i=this.frames.join("");this.frames=null;const s=(0,u.cI)(i);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,u.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){const i=Number(e);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const i=e.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(i);else{const s=this.extractFrameCount_(i);null!==s&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const i=(0,u.Wl)(e);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const s=bs(i,16384);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),Ws=(()=>{class n{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[le,Le]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const i=Le&&Le.isAvailable();let s=i&&!Le.previouslyFailed();if(e.webSocketOnly&&(i||R("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Le];else{const r=this.transports_=[];for(const o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return n.globalTransportInitialized_=!1,n})();class zs{constructor(t,e,i,s,r,o,a,c,h,d){this.id=t,this.repoInfo_=e,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=h,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Je("c:"+this.id+":"),this.transportManager_=new Ws(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,i)},Math.floor(0));const s=t.healthyTimeout||0;s>0&&(this.healthyTimeout_=et(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){this.sendData_({t:"d",d:t})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if("t"in t){const e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=Xe("t",t),i=Xe("d",t);if("c"===e)this.onSecondaryControl_(i);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(i)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=Xe("t",t),i=Xe("d",t);"c"===e?this.onControl_(i):"d"===e&&this.onDataMessage_(i)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=Xe("t",t);if("d"in t){const i=t.d;if("h"===e){const s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(i):"r"===e?this.onReset_(i):"e"===e?Mn("Server Error: "+i):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Mn("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,i=t.v,s=t.h;this.sessionId=t.s,this.repoInfo_.host=s,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==i&&R("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,i),et(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):et(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(be.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Ks{put(t,e,i,s){}merge(t,e,i,s){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,i){}onDisconnectMerge(t,e,i){}onDisconnectCancel(t,e){}reportStats(t){}}class Zs{constructor(t){this.allowedEvents_=t,this.listeners_={},(0,u.hu)(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const i=[...this.listeners_[t]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,e)}}on(t,e,i){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:i});const s=this.getInitialEvent(t);s&&e.apply(i,s)}off(t,e,i){this.validateEventType_(t);const s=this.listeners_[t]||[];for(let r=0;r<s.length;r++)if(s[r].callback===e&&(!i||i===s[r].context))return void s.splice(r,1)}validateEventType_(t){(0,u.hu)(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class Vt extends Zs{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!(0,u.uI)()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Vt}getInitialEvent(t){return(0,u.hu)("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}class S{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function b(){return new S("")}function v(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ce(n){return n.pieces_.length-n.pieceNum_}function A(n){let t=n.pieceNum_;return t<n.pieces_.length&&t++,new S(n.pieces_,t)}function Bn(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function nt(n,t=0){return n.pieces_.slice(n.pieceNum_+t)}function er(n){if(n.pieceNum_>=n.pieces_.length)return null;const t=[];for(let e=n.pieceNum_;e<n.pieces_.length-1;e++)t.push(n.pieces_[e]);return new S(t,0)}function D(n,t){const e=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)e.push(n.pieces_[i]);if(t instanceof S)for(let i=t.pieceNum_;i<t.pieces_.length;i++)e.push(t.pieces_[i]);else{const i=t.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&e.push(i[s])}return new S(e,0)}function C(n){return n.pieceNum_>=n.pieces_.length}function V(n,t){const e=v(n),i=v(t);if(null===e)return t;if(e===i)return V(A(n),A(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+n+")")}function Vl(n,t){const e=nt(n,0),i=nt(t,0);for(let s=0;s<e.length&&s<i.length;s++){const r=Ae(e[s],i[s]);if(0!==r)return r}return e.length===i.length?0:e.length<i.length?-1:1}function Gn(n,t){if(ce(n)!==ce(t))return!1;for(let e=n.pieceNum_,i=t.pieceNum_;e<=n.pieces_.length;e++,i++)if(n.pieces_[e]!==t.pieces_[i])return!1;return!0}function W(n,t){let e=n.pieceNum_,i=t.pieceNum_;if(ce(n)>ce(t))return!1;for(;e<n.pieces_.length;){if(n.pieces_[e]!==t.pieces_[i])return!1;++e,++i}return!0}class Fl{constructor(t,e){this.errorPrefix_=e,this.parts_=nt(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=(0,u.ug)(this.parts_[i]);tr(this)}}function tr(n){if(n.byteLength_>768)throw new Error(n.errorPrefix_+"has a key path longer than 768 bytes ("+n.byteLength_+").");if(n.parts_.length>32)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Te(n))}function Te(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class Un extends Zs{constructor(){let t,e;super(["visible"]),typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(e="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(e="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(e="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{const i=!document[t];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new Un}getInitialEvent(t){return(0,u.hu)("visible"===t,"Unknown event type: "+t),[this.visible_]}}const it=1e3;let Lt,Ie=(()=>{class n extends Ks{constructor(e,i,s,r,o,a,c,h){if(super(),this.repoInfo_=e,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=h,this.id=n.nextPersistentConnectionId_++,this.log_=Je("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=it,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h&&!(0,u.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Un.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Vt.getInstance().on("online",this.onOnline_,this)}sendRequest(e,i,s){const r=++this.requestNumber_,o={r,a:e,b:i};this.log_((0,u.Wl)(o)),(0,u.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(e){this.initConnection_();const i=new u.BH,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:a=>{const c=a.d;"ok"===a.s?i.resolve(c):i.reject(c)}};return this.outstandingGets_.push(r),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),i.promise}listen(e,i,s,r){this.initConnection_();const o=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),(0,u.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,u.hu)(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");const c={onComplete:r,hashFn:i,query:e,tag:s};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(e){const i=this.outstandingGets_[e];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(e){const i=e.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);const o={p:s};e.tag&&(o.q=i._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,c=>{const h=c.d,d=c.s;n.warnOnListenWarnings_(h,i),(this.listens.get(s)&&this.listens.get(s).get(r))===e&&(this.log_("listen response",c),"ok"!==d&&this.removeListen_(s,r),e.onComplete&&e.onComplete(d,h))})}static warnOnListenWarnings_(e,i){if(e&&"object"==typeof e&&(0,u.r3)(e,"w")){const s=(0,u.DV)(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();R(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,u.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,i=(0,u.w9)(e)?"auth":"gauth",s={cred:e};null===this.authOverride_?s.noauth=!0:"object"==typeof this.authOverride_&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{const o=r.s,a=r.d||"error";this.authToken_===e&&("ok"===o?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const i=e.s,s=e.d||"error";"ok"===i?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(e,i){const s=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),(0,u.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,e._queryObject,i)}sendUnlisten_(e,i,s,r){this.log_("Unlisten on "+e+" for "+i);const o={p:e};r&&(o.q=s,o.t=r),this.sendRequest("n",o)}onDisconnectPut(e,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,i,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:i,onComplete:s})}onDisconnectMerge(e,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,i,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:i,onComplete:s})}onDisconnectCancel(e,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(e,i,s,r){const o={p:i,d:s};this.log_("onDisconnect "+e,o),this.sendRequest(e,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(e,i,s,r){this.putInternal("p",e,i,s,r)}merge(e,i,s,r){this.putInternal("m",e,i,s,r)}putInternal(e,i,s,r,o){this.initConnection_();const a={p:i,d:s};void 0!==o&&(a.h=o),this.outstandingPuts_.push({action:e,request:a,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+i)}sendPut_(e){const i=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(e){if(this.connected_){const i={c:e};this.log_("reportStats",i),this.sendRequest("s",i,s=>{"ok"!==s.s&&this.log_("reportStats","Error sending stats: "+s.d)})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,u.Wl)(e));const i=e.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,i){this.log_("handleServerMessage",e,i),"d"===e?this.onDataUpdate_(i.p,i.d,!1,i.t):"m"===e?this.onDataUpdate_(i.p,i.d,!0,i.t):"c"===e?this.onListenRevoked_(i.p,i.q):"ac"===e?this.onAuthRevoked_(i.s,i.d):"apc"===e?this.onAppCheckRevoked_(i.s,i.d):"sd"===e?this.onSecurityDebugPacket_(i):Mn("Unrecognized action received from server: "+(0,u.Wl)(e)+"\nAre you using the latest client?")}onReady_(e,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,u.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=it,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=it,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=it),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let i=Math.max(0,this.reconnectDelay_-e);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var e=this;return(0,Ka.Z)(function*(){if(e.shouldReconnect_()){e.log_("Making a connection attempt"),e.lastConnectionAttemptTime_=(new Date).getTime(),e.lastConnectionEstablishedTime_=null;const i=e.onDataMessage_.bind(e),s=e.onReady_.bind(e),r=e.onRealtimeDisconnect_.bind(e),o=e.id+":"+n.nextConnectionId_++,a=e.lastSessionId;let c=!1,h=null;const d=function(){h?h.close():(c=!0,r())};e.realtime_={close:d,sendRequest:function(_){(0,u.hu)(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(_)}};const p=e.forceTokenRefresh_;e.forceTokenRefresh_=!1;try{const[_,g]=yield Promise.all([e.authTokenProvider_.getToken(p),e.appCheckTokenProvider_.getToken(p)]);c?M("getToken() completed but was canceled"):(M("getToken() completed. Creating connection."),e.authToken_=_&&_.accessToken,e.appCheckToken_=g&&g.token,h=new zs(o,e.repoInfo_,e.applicationId_,e.appCheckToken_,e.authToken_,i,s,r,E=>{R(E+" ("+e.repoInfo_.toString()+")"),e.interrupt("server_kill")},a))}catch(_){e.log_("Failed to get token: "+_),c||(e.repoInfo_.nodeAdmin&&R(_),d())}}})()}interrupt(e){M("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){M("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,u.xb)(this.interruptReasons_)&&(this.reconnectDelay_=it,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const i=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const i=this.outstandingPuts_[e];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,i){let s;s=i?i.map(o=>xn(o)).join("$"):"default";const r=this.removeListen_(e,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,i){const s=new S(e).toString();let r;if(this.listens.has(s)){const o=this.listens.get(s);r=o.get(i),o.delete(i),0===o.size&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(e,i){M("Auth token revoked: "+e+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,i){M("App check token revoked: "+e+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const i of e.values())this.sendListen_(i);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let i="js";(0,u.Yr)()&&(i=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+i+"."+In.replace(/\./g,"-")]=1,(0,u.uI)()?e["framework.cordova"]=1:(0,u.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Vt.getInstance().currentlyOnline();return(0,u.xb)(this.interruptReasons_)&&e}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class w{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new w(t,e)}}class Ft{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const i=new w(ae,t),s=new w(ae,e);return 0!==this.compare(i,s)}minPost(){return w.MIN}}class sr extends Ft{static get __EMPTY_NODE(){return Lt}static set __EMPTY_NODE(t){Lt=t}compare(t,e){return Ae(t.name,e.name)}isDefinedOn(t){throw(0,u.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return w.MIN}maxPost(){return new w(te,Lt)}makePost(t,e){return(0,u.hu)("string"==typeof t,"KeyIndex indexValue must always be a string."),new w(t,Lt)}toString(){return".key"}}const K=new sr;class Bt{constructor(t,e,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!t.isEmpty();)if(o=e?i(t.key,e):1,s&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}let Hn,Y=(()=>{class n{constructor(e,i,s,r,o){this.key=e,this.value=i,this.color=s??n.RED,this.left=r??L.EMPTY_NODE,this.right=o??L.EMPTY_NODE}copy(e,i,s,r,o){return new n(e??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,s){let r=this;const o=s(e,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(e,i,s),null):0===o?r.copy(null,i,null,null,null):r.copy(null,null,null,null,r.right.insert(e,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return L.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,i){let s,r;if(s=this,i(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),0===i(e,s.key)){if(s.right.isEmpty())return L.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class L{constructor(t,e=L.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new L(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Y.BLACK,null,null))}remove(t){return new L(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Y.BLACK,null,null))}get(t){let e,i=this.root_;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),0===e)return i.value;e<0?i=i.left:e>0&&(i=i.right)}return null}getPredecessorKey(t){let e,i=this.root_,s=null;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),0===e){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}e<0?i=i.left:e>0&&(s=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new Bt(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new Bt(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new Bt(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new Bt(this.root_,null,this.comparator_,!0,t)}}function Yl(n,t){return Ae(n.name,t.name)}function Wn(n,t){return Ae(n,t)}L.EMPTY_NODE=new class jl{copy(t,e,i,s,r){return this}insert(t,e,i){return new Y(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const rr=function(n){return"number"==typeof n?"number:"+Ss(n):"string:"+n},or=function(n){if(n.isLeafNode()){const t=n.val();(0,u.hu)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,u.r3)(t,".sv"),"Priority must be a string or number.")}else(0,u.hu)(n===Hn||n.isEmpty(),"priority of unexpected type.");(0,u.hu)(n===Hn||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let ar,lr,cr,Be=(()=>{class n{constructor(e,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=i,this.lazyHash_=null,(0,u.hu)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),or(this.priorityNode_)}static set __childrenNodeConstructor(e){ar=e}static get __childrenNodeConstructor(){return ar}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new n(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return C(e)?this:".priority"===v(e)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,i){return null}updateImmediateChild(e,i){return".priority"===e?this.updatePriority(i):i.isEmpty()&&".priority"!==e?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,i).updatePriority(this.priorityNode_)}updateChild(e,i){const s=v(e);return null===s?i:i.isEmpty()&&".priority"!==s?this:((0,u.hu)(".priority"!==s||1===ce(e),".priority must be the last token in a path"),this.updateImmediateChild(s,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(A(e),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,i){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+rr(this.priorityNode_.val())+":");const i=typeof this.value_;e+=i+":",e+="number"===i?Ss(this.value_):this.value_,this.lazyHash_=Cs(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===n.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof n.__childrenNodeConstructor?-1:((0,u.hu)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const i=typeof e.value_,s=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(s);return(0,u.hu)(r>=0,"Unknown leaf type: "+i),(0,u.hu)(o>=0,"Unknown leaf type: "+s),r===o?"object"===s?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const T=new class zl extends Ft{compare(t,e){const i=t.node.getPriority(),s=e.node.getPriority(),r=i.compareTo(s);return 0===r?Ae(t.name,e.name):r}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return w.MIN}maxPost(){return new w(te,new Be("[PRIORITY-POST]",cr))}makePost(t,e){const i=lr(t);return new w(e,new Be("[PRIORITY-POST]",i))}toString(){return".priority"}},Kl=Math.log(2);class Zl{constructor(t){this.count=parseInt(Math.log(t+1)/Kl,10),this.current_=this.count-1;const s=(r=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=t+1&s}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const Gt=function(n,t,e,i){n.sort(t);const s=function(c,h){const d=h-c;let f,p;if(0===d)return null;if(1===d)return f=n[c],p=e?e(f):f,new Y(p,f.node,Y.BLACK,null,null);{const _=parseInt(d/2,10)+c,g=s(c,_),E=s(_+1,h);return f=n[_],p=e?e(f):f,new Y(p,f.node,Y.BLACK,g,E)}},a=function(c){let h=null,d=null,f=n.length;const p=function(g,E){const O=f-g,ee=f;f-=g;const ie=s(O+1,ee),Ke=n[O],vf=e?e(Ke):Ke;_(new Y(vf,Ke.node,E,null,ie))},_=function(g){h?(h.left=g,h=g):(d=g,h=g)};for(let g=0;g<c.count;++g){const E=c.nextBitIsOne(),O=Math.pow(2,c.count-(g+1));E?p(O,Y.BLACK):(p(O,Y.BLACK),p(O,Y.RED))}return d}(new Zl(n.length));return new L(i||t,a)};let jn;const Ge={};class ne{constructor(t,e){this.indexes_=t,this.indexSet_=e}static get Default(){return(0,u.hu)(Ge&&T,"ChildrenNode.ts has not been loaded"),jn=jn||new ne({".priority":Ge},{".priority":T}),jn}get(t){const e=(0,u.DV)(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof L?e:null}hasIndex(t){return(0,u.r3)(this.indexSet_,t.toString())}addIndex(t,e){(0,u.hu)(t!==K,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=e.getIterator(w.Wrap);let a,o=r.getNext();for(;o;)s=s||t.isDefinedOn(o.node),i.push(o),o=r.getNext();a=s?Gt(i,t.getCompare()):Ge;const c=t.toString(),h=Object.assign({},this.indexSet_);h[c]=t;const d=Object.assign({},this.indexes_);return d[c]=a,new ne(d,h)}addToIndexes(t,e){const i=(0,u.UI)(this.indexes_,(s,r)=>{const o=(0,u.DV)(this.indexSet_,r);if((0,u.hu)(o,"Missing index implementation for "+r),s===Ge){if(o.isDefinedOn(t.node)){const a=[],c=e.getIterator(w.Wrap);let h=c.getNext();for(;h;)h.name!==t.name&&a.push(h),h=c.getNext();return a.push(t),Gt(a,o.getCompare())}return Ge}{const a=e.get(t.name);let c=s;return a&&(c=c.remove(new w(t.name,a))),c.insert(t,t.node)}});return new ne(i,this.indexSet_)}removeFromIndexes(t,e){const i=(0,u.UI)(this.indexes_,s=>{if(s===Ge)return s;{const r=e.get(t.name);return r?s.remove(new w(t.name,r)):s}});return new ne(i,this.indexSet_)}}let st,m=(()=>{class n{constructor(e,i,s){this.children_=e,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&or(this.priorityNode_),this.children_.isEmpty()&&(0,u.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return st||(st=new n(new L(Wn),null,ne.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||st}updatePriority(e){return this.children_.isEmpty()?this:new n(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const i=this.children_.get(e);return null===i?st:i}}getChild(e){const i=v(e);return null===i?this:this.getImmediateChild(i).getChild(A(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,i){if((0,u.hu)(i,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(i);{const s=new w(e,i);let r,o;i.isEmpty()?(r=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(e,i),o=this.indexMap_.addToIndexes(s,this.children_));const a=r.isEmpty()?st:this.priorityNode_;return new n(r,a,o)}}updateChild(e,i){const s=v(e);if(null===s)return i;{(0,u.hu)(".priority"!==v(e)||1===ce(e),".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(A(e),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const i={};let s=0,r=0,o=!0;if(this.forEachChild(T,(a,c)=>{i[a]=c.val(e),s++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!e&&o&&r<2*s){const a=[];for(const c in i)a[c]=i[c];return a}return e&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+rr(this.getPriority().val())+":"),this.forEachChild(T,(i,s)=>{const r=s.hash();""!==r&&(e+=":"+i+":"+r)}),this.lazyHash_=""===e?"":Cs(e)}return this.lazyHash_}getPredecessorChildName(e,i,s){const r=this.resolveIndex_(s);if(r){const o=r.getPredecessorKey(new w(e,i));return o?o.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const i=this.resolveIndex_(e);if(i){const s=i.minKey();return s&&s.name}return this.children_.minKey()}getFirstChild(e){const i=this.getFirstChildName(e);return i?new w(i,this.children_.get(i)):null}getLastChildName(e){const i=this.resolveIndex_(e);if(i){const s=i.maxKey();return s&&s.name}return this.children_.maxKey()}getLastChild(e){const i=this.getLastChildName(e);return i?new w(i,this.children_.get(i)):null}forEachChild(e,i){const s=this.resolveIndex_(e);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,i){const s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,w.Wrap);let o=r.peek();for(;null!=o&&i.compare(o,e)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,i){const s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,w.Wrap);let o=r.peek();for(;null!=o&&i.compare(o,e)>0;)r.getNext(),o=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===rt?-1:0}withIndex(e){if(e===K||this.indexMap_.hasIndex(e))return this;{const i=this.indexMap_.addIndex(e,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(e){return e===K||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const i=e;if(this.getPriority().equals(i.getPriority())){if(this.children_.count()===i.children_.count()){const s=this.getIterator(T),r=i.getIterator(T);let o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return null===o&&null===a}return!1}return!1}}resolveIndex_(e){return e===K?null:this.indexMap_.get(e.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const rt=new class Jl extends m{constructor(){super(new L(Wn),m.EMPTY_NODE,ne.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return m.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(w,{MIN:{value:new w(ae,m.EMPTY_NODE)},MAX:{value:new w(te,rt)}}),sr.__EMPTY_NODE=m.EMPTY_NODE,Be.__childrenNodeConstructor=m,function ql(n){Hn=n}(rt),function $l(n){cr=n}(rt);const Xl=!0;function N(n,t=null){if(null===n)return m.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(t=n[".priority"]),(0,u.hu)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new Be(n,N(t));if(n instanceof Array||!Xl){let e=m.EMPTY_NODE;return x(n,(i,s)=>{if((0,u.r3)(n,i)&&"."!==i.substring(0,1)){const r=N(s);(r.isLeafNode()||!r.isEmpty())&&(e=e.updateImmediateChild(i,r))}}),e.updatePriority(N(t))}{const e=[];let i=!1;if(x(n,(o,a)=>{if("."!==o.substring(0,1)){const c=N(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),e.push(new w(o,c)))}}),0===e.length)return m.EMPTY_NODE;const r=Gt(e,Yl,o=>o.name,Wn);if(i){const o=Gt(e,T.getCompare());return new m(r,N(t),new ne({".priority":o},{".priority":T}))}return new m(r,N(t),ne.Default)}}!function Ql(n){lr=n}(N);class Yn extends Ft{constructor(t){super(),this.indexPath_=t,(0,u.hu)(!C(t)&&".priority"!==v(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const i=this.extractChild(t.node),s=this.extractChild(e.node),r=i.compareTo(s);return 0===r?Ae(t.name,e.name):r}makePost(t,e){const i=N(t),s=m.EMPTY_NODE.updateChild(this.indexPath_,i);return new w(e,s)}maxPost(){const t=m.EMPTY_NODE.updateChild(this.indexPath_,rt);return new w(te,t)}toString(){return nt(this.indexPath_,0).join("/")}}const qn=new class ec extends Ft{compare(t,e){const i=t.node.compareTo(e.node);return 0===i?Ae(t.name,e.name):i}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return w.MIN}maxPost(){return w.MAX}makePost(t,e){const i=N(t);return new w(e,i)}toString(){return".value"}};function ur(n){return{type:"value",snapshotNode:n}}function Ue(n,t){return{type:"child_added",snapshotNode:t,childName:n}}function ot(n,t){return{type:"child_removed",snapshotNode:t,childName:n}}function at(n,t,e){return{type:"child_changed",snapshotNode:t,childName:n,oldSnap:e}}class Qn{constructor(t){this.index_=t}updateChild(t,e,i,s,r,o){(0,u.hu)(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=t.getImmediateChild(e);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(null!=o&&(i.isEmpty()?t.hasChild(e)?o.trackChildChange(ot(e,a)):(0,u.hu)(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Ue(e,i)):o.trackChildChange(at(e,i,a))),t.isLeafNode()&&i.isEmpty())?t:t.updateImmediateChild(e,i).withIndex(this.index_)}updateFullNode(t,e,i){return null!=i&&(t.isLeafNode()||t.forEachChild(T,(s,r)=>{e.hasChild(s)||i.trackChildChange(ot(s,r))}),e.isLeafNode()||e.forEachChild(T,(s,r)=>{if(t.hasChild(s)){const o=t.getImmediateChild(s);o.equals(r)||i.trackChildChange(at(s,r,o))}else i.trackChildChange(Ue(s,r))})),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?m.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class lt{constructor(t){this.indexedFilter_=new Qn(t.getIndex()),this.index_=t.getIndex(),this.startPost_=lt.getStartPost_(t),this.endPost_=lt.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,i=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&i}updateChild(t,e,i,s,r,o){return this.matches(new w(e,i))||(i=m.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,i,s,r,o)}updateFullNode(t,e,i){e.isLeafNode()&&(e=m.EMPTY_NODE);let s=e.withIndex(this.index_);s=s.updatePriority(m.EMPTY_NODE);const r=this;return e.forEachChild(T,(o,a)=>{r.matches(new w(o,a))||(s=s.updateImmediateChild(o,m.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,s,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()}}class nc{constructor(t){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=e=>{const i=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new lt(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,i,s,r,o){return this.rangedFilter_.matches(new w(e,i))||(i=m.EMPTY_NODE),t.getImmediateChild(e).equals(i)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,i,s,r,o):this.fullLimitUpdateChild_(t,e,i,r,o)}updateFullNode(t,e,i){let s;if(e.isLeafNode()||e.isEmpty())s=m.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){let r;s=m.EMPTY_NODE.withIndex(this.index_),r=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a)){if(!this.withinDirectionalEnd(a))break;s=s.updateImmediateChild(a.name,a.node),o++}}}else{let r;s=e.withIndex(this.index_),s=s.updatePriority(m.EMPTY_NODE),r=this.reverse_?s.getReverseIterator(this.index_):s.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,m.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,s,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,i,s,r){let o;if(this.reverse_){const f=this.index_.getCompare();o=(p,_)=>f(_,p)}else o=this.index_.getCompare();const a=t;(0,u.hu)(a.numChildren()===this.limit_,"");const c=new w(e,i),h=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(e)){const f=a.getImmediateChild(e);let p=s.getChildAfterChild(this.index_,h,this.reverse_);for(;null!=p&&(p.name===e||a.hasChild(p.name));)p=s.getChildAfterChild(this.index_,p,this.reverse_);const _=null==p?1:o(p,c);if(d&&!i.isEmpty()&&_>=0)return r?.trackChildChange(at(e,i,f)),a.updateImmediateChild(e,i);{r?.trackChildChange(ot(e,f));const E=a.updateImmediateChild(e,m.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(r?.trackChildChange(Ue(p.name,p.node)),E.updateImmediateChild(p.name,p.node)):E}}return i.isEmpty()?t:d&&o(h,c)>=0?(null!=r&&(r.trackChildChange(ot(h.name,h.node)),r.trackChildChange(Ue(e,i))),a.updateImmediateChild(e,i).updateImmediateChild(h.name,m.EMPTY_NODE)):t}}class Ut{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=T}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,u.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,u.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ae}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,u.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,u.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:te}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,u.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===T}copy(){const t=new Ut;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function $n(n,t,e){const i=n.copy();return i.startSet_=!0,void 0===t&&(t=null),i.indexStartValue_=t,null!=e?(i.startNameSet_=!0,i.indexStartName_=e):(i.startNameSet_=!1,i.indexStartName_=""),i}function zn(n,t,e){const i=n.copy();return i.endSet_=!0,void 0===t&&(t=null),i.indexEndValue_=t,void 0!==e?(i.endNameSet_=!0,i.indexEndName_=e):(i.endNameSet_=!1,i.indexEndName_=""),i}function Wt(n,t){const e=n.copy();return e.index_=t,e}function hr(n){const t={};if(n.isDefault())return t;let e;if(n.index_===T?e="$priority":n.index_===qn?e="$value":n.index_===K?e="$key":((0,u.hu)(n.index_ instanceof Yn,"Unrecognized index type!"),e=n.index_.toString()),t.orderBy=(0,u.Wl)(e),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";t[i]=(0,u.Wl)(n.indexStartValue_),n.startNameSet_&&(t[i]+=","+(0,u.Wl)(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";t[i]=(0,u.Wl)(n.indexEndValue_),n.endNameSet_&&(t[i]+=","+(0,u.Wl)(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?t.limitToFirst=n.limit_:t.limitToLast=n.limit_),t}function dr(n){const t={};if(n.startSet_&&(t.sp=n.indexStartValue_,n.startNameSet_&&(t.sn=n.indexStartName_),t.sin=!n.startAfterSet_),n.endSet_&&(t.ep=n.indexEndValue_,n.endNameSet_&&(t.en=n.indexEndName_),t.ein=!n.endBeforeSet_),n.limitSet_){t.l=n.limit_;let e=n.viewFrom_;""===e&&(e=n.isViewFromLeft()?"l":"r"),t.vf=e}return n.index_!==T&&(t.i=n.index_.toString()),t}class Ht extends Ks{constructor(t,e,i,s){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=Je("p:rest:"),this.listens_={}}reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return void 0!==e?"tag$"+e:((0,u.hu)(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}listen(t,e,i,s){const r=t._path.toString();this.log_("Listen called for "+r+" "+t._queryIdentifier);const o=Ht.getListenId_(t,i),a={};this.listens_[o]=a;const c=hr(t._queryParams);this.restRequest_(r+".json",c,(h,d)=>{let f=d;if(404===h&&(f=null,h=null),null===h&&this.onDataUpdate_(r,f,!1,i),(0,u.DV)(this.listens_,o)===a){let p;p=h?401===h?"permission_denied":"rest_error:"+h:"ok",s(p,null)}})}unlisten(t,e){const i=Ht.getListenId_(t,e);delete this.listens_[i]}get(t){const e=hr(t._queryParams),i=t._path.toString(),s=new u.BH;return this.restRequest_(i+".json",e,(r,o)=>{let a=o;404===r&&(a=null,r=null),null===r?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(t){}restRequest_(t,e={},i){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(e.auth=s.accessToken),r&&r.token&&(e.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+(0,u.xO)(e);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=(0,u.cI)(a.responseText)}catch{R("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else 401!==a.status&&404!==a.status&&R("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}class lc{constructor(){this.rootNode_=m.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}function jt(){return{value:null,children:new Map}}function We(n,t,e){if(C(t))n.value=e,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(t,e);else{const i=v(t);n.children.has(i)||n.children.set(i,jt()),We(n.children.get(i),t=A(t),e)}}function Kn(n,t){if(C(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const e=n.value;return n.value=null,e.forEachChild(T,(i,s)=>{We(n,new S(i),s)}),Kn(n,t)}}if(n.children.size>0){const e=v(t);return t=A(t),n.children.has(e)&&Kn(n.children.get(e),t)&&n.children.delete(e),0===n.children.size}return!0}function Zn(n,t,e){null!==n.value?e(t,n.value):function cc(n,t){n.children.forEach((e,i)=>{t(i,e)})}(n,(i,s)=>{Zn(s,new S(t.toString()+"/"+i),e)})}class uc{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&x(this.last_,(i,s)=>{e[i]=e[i]-s}),this.last_=t,e}}class fc{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new uc(t);const i=1e4+2e4*Math.random();et(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const t=this.statsListener_.get(),e={};let i=!1;x(t,(s,r)=>{r>0&&(0,u.r3)(this.statsToReport_,s)&&(e[s]=r,i=!0)}),i&&this.server_.reportStats(e),et(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Z=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Z||{});function ei(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class Yt{constructor(t,e,i){this.path=t,this.affectedTree=e,this.revert=i,this.type=Z.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(t){if(C(this.path)){if(null!=this.affectedTree.value)return(0,u.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new S(t));return new Yt(b(),e,this.revert)}}return(0,u.hu)(v(this.path)===t,"operationForChild called for unrelated child."),new Yt(A(this.path),this.affectedTree,this.revert)}}class ct{constructor(t,e){this.source=t,this.path=e,this.type=Z.LISTEN_COMPLETE}operationForChild(t){return C(this.path)?new ct(this.source,b()):new ct(this.source,A(this.path))}}class De{constructor(t,e,i){this.source=t,this.path=e,this.snap=i,this.type=Z.OVERWRITE}operationForChild(t){return C(this.path)?new De(this.source,b(),this.snap.getImmediateChild(t)):new De(this.source,A(this.path),this.snap)}}class He{constructor(t,e,i){this.source=t,this.path=e,this.children=i,this.type=Z.MERGE}operationForChild(t){if(C(this.path)){const e=this.children.subtree(new S(t));return e.isEmpty()?null:e.value?new De(this.source,b(),e.value):new He(this.source,b(),e)}return(0,u.hu)(v(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new He(this.source,A(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ue{constructor(t,e,i){this.node_=t,this.fullyInitialized_=e,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(C(t))return this.isFullyInitialized()&&!this.filtered_;const e=v(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}class pc{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function ut(n,t,e,i,s,r){const o=i.filter(a=>a.type===e);o.sort((a,c)=>function mc(n,t,e){if(null==t.childName||null==e.childName)throw(0,u.g5)("Should only compare child_ events.");const i=new w(t.childName,t.snapshotNode),s=new w(e.childName,e.snapshotNode);return n.index_.compare(i,s)}(n,a,c)),o.forEach(a=>{const c=function gc(n,t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,n.index_)),t}(n,a,r);s.forEach(h=>{h.respondsTo(a.type)&&t.push(h.createEvent(c,n.query_))})})}function qt(n,t){return{eventCache:n,serverCache:t}}function ht(n,t,e,i){return qt(new ue(t,e,i),n.serverCache)}function pr(n,t,e,i){return qt(n.eventCache,new ue(t,e,i))}function Qt(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Ne(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let ti;class I{constructor(t,e=(()=>(ti||(ti=new L(tl)),ti))()){this.value=t,this.children=e}static fromObject(t){let e=new I(null);return x(t,(i,s)=>{e=e.set(new S(i),s)}),e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:b(),value:this.value};if(C(t))return null;{const i=v(t),s=this.children.get(i);if(null!==s){const r=s.findRootMostMatchingPathAndValue(A(t),e);return null!=r?{path:D(new S(i),r.path),value:r.value}:null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(C(t))return this;{const e=v(t),i=this.children.get(e);return null!==i?i.subtree(A(t)):new I(null)}}set(t,e){if(C(t))return new I(e,this.children);{const i=v(t),r=(this.children.get(i)||new I(null)).set(A(t),e),o=this.children.insert(i,r);return new I(this.value,o)}}remove(t){if(C(t))return this.children.isEmpty()?new I(null):new I(null,this.children);{const e=v(t),i=this.children.get(e);if(i){const s=i.remove(A(t));let r;return r=s.isEmpty()?this.children.remove(e):this.children.insert(e,s),null===this.value&&r.isEmpty()?new I(null):new I(this.value,r)}return this}}get(t){if(C(t))return this.value;{const e=v(t),i=this.children.get(e);return i?i.get(A(t)):null}}setTree(t,e){if(C(t))return e;{const i=v(t),r=(this.children.get(i)||new I(null)).setTree(A(t),e);let o;return o=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new I(this.value,o)}}fold(t){return this.fold_(b(),t)}fold_(t,e){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(D(t,s),e)}),e(t,this.value,i)}findOnPath(t,e){return this.findOnPath_(t,b(),e)}findOnPath_(t,e,i){const s=!!this.value&&i(e,this.value);if(s)return s;if(C(t))return null;{const r=v(t),o=this.children.get(r);return o?o.findOnPath_(A(t),D(e,r),i):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,b(),e)}foreachOnPath_(t,e,i){if(C(t))return this;{this.value&&i(e,this.value);const s=v(t),r=this.children.get(s);return r?r.foreachOnPath_(A(t),D(e,s),i):new I(null)}}foreach(t){this.foreach_(b(),t)}foreach_(t,e){this.children.inorderTraversal((i,s)=>{s.foreach_(D(t,i),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,i)=>{i.value&&t(e,i.value)})}}class q{constructor(t){this.writeTree_=t}static empty(){return new q(new I(null))}}function dt(n,t,e){if(C(t))return new q(new I(e));{const i=n.writeTree_.findRootMostValueAndPath(t);if(null!=i){const s=i.path;let r=i.value;const o=V(s,t);return r=r.updateChild(o,e),new q(n.writeTree_.set(s,r))}{const s=new I(e),r=n.writeTree_.setTree(t,s);return new q(r)}}}function ni(n,t,e){let i=n;return x(e,(s,r)=>{i=dt(i,D(t,s),r)}),i}function _r(n,t){if(C(t))return q.empty();{const e=n.writeTree_.setTree(t,new I(null));return new q(e)}}function ii(n,t){return null!=Me(n,t)}function Me(n,t){const e=n.writeTree_.findRootMostValueAndPath(t);return null!=e?n.writeTree_.get(e.path).getChild(V(e.path,t)):null}function gr(n){const t=[],e=n.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(T,(i,s)=>{t.push(new w(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{null!=s.value&&t.push(new w(i,s.value))}),t}function he(n,t){if(C(t))return n;{const e=Me(n,t);return new q(null!=e?new I(e):n.writeTree_.subtree(t))}}function si(n){return n.writeTree_.isEmpty()}function je(n,t){return mr(b(),n.writeTree_,t)}function mr(n,t,e){if(null!=t.value)return e.updateChild(n,t.value);{let i=null;return t.children.inorderTraversal((s,r)=>{".priority"===s?((0,u.hu)(null!==r.value,"Priority writes must always be leaf nodes"),i=r.value):e=mr(D(n,s),r,e)}),!e.getChild(n).isEmpty()&&null!==i&&(e=e.updateChild(D(n,".priority"),i)),e}}function $t(n,t){return Er(t,n)}function bc(n,t){if(n.snap)return W(n.path,t);for(const e in n.children)if(n.children.hasOwnProperty(e)&&W(D(n.path,e),t))return!0;return!1}function Ac(n){return n.visible}function yr(n,t,e){let i=q.empty();for(let s=0;s<n.length;++s){const r=n[s];if(t(r)){const o=r.path;let a;if(r.snap)W(e,o)?(a=V(e,o),i=dt(i,a,r.snap)):W(o,e)&&(a=V(o,e),i=dt(i,b(),r.snap.getChild(a)));else{if(!r.children)throw(0,u.g5)("WriteRecord should have .snap or .children");if(W(e,o))a=V(e,o),i=ni(i,a,r.children);else if(W(o,e))if(a=V(o,e),C(a))i=ni(i,b(),r.children);else{const c=(0,u.DV)(r.children,v(a));if(c){const h=c.getChild(A(a));i=dt(i,b(),h)}}}}}return i}function vr(n,t,e,i,s){if(i||s){const r=he(n.visibleWrites,t);return!s&&si(r)?e:s||null!=e||ii(r,b())?je(yr(n.allWrites,function(h){return(h.visible||s)&&(!i||!~i.indexOf(h.writeId))&&(W(h.path,t)||W(t,h.path))},t),e||m.EMPTY_NODE):null}{const r=Me(n.visibleWrites,t);if(null!=r)return r;{const o=he(n.visibleWrites,t);return si(o)?e:null!=e||ii(o,b())?je(o,e||m.EMPTY_NODE):null}}}function zt(n,t,e,i){return vr(n.writeTree,n.treePath,t,e,i)}function ri(n,t){return function Tc(n,t,e){let i=m.EMPTY_NODE;const s=Me(n.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild(T,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(e){const r=he(n.visibleWrites,t);return e.forEachChild(T,(o,a)=>{const c=je(he(r,new S(o)),a);i=i.updateImmediateChild(o,c)}),gr(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}return gr(he(n.visibleWrites,t)).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}(n.writeTree,n.treePath,t)}function Cr(n,t,e,i){return function Ic(n,t,e,i,s){(0,u.hu)(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=D(t,e);if(ii(n.visibleWrites,r))return null;{const o=he(n.visibleWrites,r);return si(o)?s.getChild(e):je(o,s.getChild(e))}}(n.writeTree,n.treePath,t,e,i)}function Kt(n,t){return function Nc(n,t){return Me(n.visibleWrites,t)}(n.writeTree,D(n.treePath,t))}function oi(n,t,e){return function Dc(n,t,e,i){const s=D(t,e),r=Me(n.visibleWrites,s);return null!=r?r:i.isCompleteForChild(e)?je(he(n.visibleWrites,s),i.getNode().getImmediateChild(e)):null}(n.writeTree,n.treePath,t,e)}function wr(n,t){return Er(D(n.treePath,t),n.writeTree)}function Er(n,t){return{treePath:n,writeTree:t}}class Pc{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,i=t.childName;(0,u.hu)("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),(0,u.hu)(".priority"!==i,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if("child_added"===e&&"child_removed"===r)this.changeMap.set(i,at(i,t.snapshotNode,s.snapshotNode));else if("child_removed"===e&&"child_added"===r)this.changeMap.delete(i);else if("child_removed"===e&&"child_changed"===r)this.changeMap.set(i,ot(i,s.oldSnap));else if("child_changed"===e&&"child_added"===r)this.changeMap.set(i,Ue(i,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==r)throw(0,u.g5)("Illegal combination of changes: "+t+" occurred after "+s);this.changeMap.set(i,at(i,t.snapshotNode,s.oldSnap))}}else this.changeMap.set(i,t)}getChanges(){return Array.from(this.changeMap.values())}}const br=new class Rc{getCompleteChild(t){return null}getChildAfterChild(t,e,i){return null}};class ai{constructor(t,e,i=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=i}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const i=null!=this.optCompleteServerCache_?new ue(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return oi(this.writes_,t,i)}}getChildAfterChild(t,e,i){const s=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Ne(this.viewCache_),r=function Oc(n,t,e,i,s,r){return function Mc(n,t,e,i,s,r,o){let a;const c=he(n.visibleWrites,t),h=Me(c,b());if(null!=h)a=h;else{if(null==e)return[];a=je(c,e)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const d=[],f=o.getCompare(),p=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let _=p.getNext();for(;_&&d.length<s;)0!==f(_,i)&&d.push(_),_=p.getNext();return d}}(n.writeTree,n.treePath,t,e,i,s,r)}(this.writes_,s,e,1,i,t);return 0===r.length?null:r[0]}}function Sr(n,t,e,i,s,r){const o=t.eventCache;if(null!=Kt(i,e))return t;{let a,c;if(C(e))if((0,u.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const h=Ne(t),f=ri(i,h instanceof m?h:m.EMPTY_NODE);a=n.filter.updateFullNode(t.eventCache.getNode(),f,r)}else{const h=zt(i,Ne(t));a=n.filter.updateFullNode(t.eventCache.getNode(),h,r)}else{const h=v(e);if(".priority"===h){(0,u.hu)(1===ce(e),"Can't have a priority with additional path components");const d=o.getNode();c=t.serverCache.getNode();const f=Cr(i,e,d,c);a=null!=f?n.filter.updatePriority(d,f):o.getNode()}else{const d=A(e);let f;if(o.isCompleteForChild(h)){c=t.serverCache.getNode();const p=Cr(i,e,o.getNode(),c);f=null!=p?o.getNode().getImmediateChild(h).updateChild(d,p):o.getNode().getImmediateChild(h)}else f=oi(i,h,t.serverCache);a=null!=f?n.filter.updateChild(o.getNode(),h,f,d,s,r):o.getNode()}}return ht(t,a,o.isFullyInitialized()||C(e),n.filter.filtersNodes())}}function Zt(n,t,e,i,s,r,o,a){const c=t.serverCache;let h;const d=o?n.filter:n.filter.getIndexedFilter();if(C(e))h=d.updateFullNode(c.getNode(),i,null);else if(d.filtersNodes()&&!c.isFiltered()){const _=c.getNode().updateChild(e,i);h=d.updateFullNode(c.getNode(),_,null)}else{const _=v(e);if(!c.isCompleteForPath(e)&&ce(e)>1)return t;const g=A(e),O=c.getNode().getImmediateChild(_).updateChild(g,i);h=".priority"===_?d.updatePriority(c.getNode(),O):d.updateChild(c.getNode(),_,O,g,br,null)}const f=pr(t,h,c.isFullyInitialized()||C(e),d.filtersNodes());return Sr(n,f,e,s,new ai(s,f,r),a)}function li(n,t,e,i,s,r,o){const a=t.eventCache;let c,h;const d=new ai(s,t,r);if(C(e))h=n.filter.updateFullNode(t.eventCache.getNode(),i,o),c=ht(t,h,!0,n.filter.filtersNodes());else{const f=v(e);if(".priority"===f)h=n.filter.updatePriority(t.eventCache.getNode(),i),c=ht(t,h,a.isFullyInitialized(),a.isFiltered());else{const p=A(e),_=a.getNode().getImmediateChild(f);let g;if(C(p))g=i;else{const E=d.getCompleteChild(f);g=null!=E?".priority"===Bn(p)&&E.getChild(er(p)).isEmpty()?E:E.updateChild(p,i):m.EMPTY_NODE}c=_.equals(g)?t:ht(t,n.filter.updateChild(a.getNode(),f,g,p,d,o),a.isFullyInitialized(),n.filter.filtersNodes())}}return c}function Ar(n,t){return n.eventCache.isCompleteForChild(t)}function Tr(n,t,e){return e.foreach((i,s)=>{t=t.updateChild(i,s)}),t}function ci(n,t,e,i,s,r,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h,c=t;h=C(e)?i:new I(null).setTree(e,i);const d=t.serverCache.getNode();return h.children.inorderTraversal((f,p)=>{if(d.hasChild(f)){const g=Tr(0,t.serverCache.getNode().getImmediateChild(f),p);c=Zt(n,c,new S(f),g,s,r,o,a)}}),h.children.inorderTraversal((f,p)=>{const _=!t.serverCache.isCompleteForChild(f)&&null===p.value;if(!d.hasChild(f)&&!_){const E=Tr(0,t.serverCache.getNode().getImmediateChild(f),p);c=Zt(n,c,new S(f),E,s,r,o,a)}}),c}class Hc{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new Qn(i.getIndex()),r=function ic(n){return n.loadsAllData()?new Qn(n.getIndex()):n.hasLimit()?new nc(n):new lt(n)}(i);this.processor_=function kc(n){return{filter:n}}(r);const o=e.serverCache,a=e.eventCache,c=s.updateFullNode(m.EMPTY_NODE,o.getNode(),null),h=r.updateFullNode(m.EMPTY_NODE,a.getNode(),null),d=new ue(c,o.isFullyInitialized(),s.filtersNodes()),f=new ue(h,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=qt(f,d),this.eventGenerator_=new pc(this.query_)}get query(){return this.query_}}function qc(n,t){const e=Ne(n.viewCache_);return e&&(n.query._queryParams.loadsAllData()||!C(t)&&!e.getImmediateChild(v(t)).isEmpty())?e.getChild(t):null}function Ir(n){return 0===n.eventRegistrations_.length}function Dr(n,t,e){const i=[];if(e){(0,u.hu)(null==t,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(e,s);o&&i.push(o)})}if(t){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(o.matches(t)){if(t.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}else s.push(o)}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function Nr(n,t,e,i){t.type===Z.MERGE&&null!==t.source.queryId&&((0,u.hu)(Ne(n.viewCache_),"We should always have a full cache before handling merges"),(0,u.hu)(Qt(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,r=function Fc(n,t,e,i,s){const r=new Pc;let o,a;if(e.type===Z.OVERWRITE){const h=e;h.source.fromUser?o=li(n,t,h.path,h.snap,i,s,r):((0,u.hu)(h.source.fromServer,"Unknown source."),a=h.source.tagged||t.serverCache.isFiltered()&&!C(h.path),o=Zt(n,t,h.path,h.snap,i,s,a,r))}else if(e.type===Z.MERGE){const h=e;h.source.fromUser?o=function Bc(n,t,e,i,s,r,o){let a=t;return i.foreach((c,h)=>{const d=D(e,c);Ar(t,v(d))&&(a=li(n,a,d,h,s,r,o))}),i.foreach((c,h)=>{const d=D(e,c);Ar(t,v(d))||(a=li(n,a,d,h,s,r,o))}),a}(n,t,h.path,h.children,i,s,r):((0,u.hu)(h.source.fromServer,"Unknown source."),a=h.source.tagged||t.serverCache.isFiltered(),o=ci(n,t,h.path,h.children,i,s,a,r))}else if(e.type===Z.ACK_USER_WRITE){const h=e;o=h.revert?function Wc(n,t,e,i,s,r){let o;if(null!=Kt(i,e))return t;{const a=new ai(i,t,s),c=t.eventCache.getNode();let h;if(C(e)||".priority"===v(e)){let d;if(t.serverCache.isFullyInitialized())d=zt(i,Ne(t));else{const f=t.serverCache.getNode();(0,u.hu)(f instanceof m,"serverChildren would be complete if leaf node"),d=ri(i,f)}h=n.filter.updateFullNode(c,d,r)}else{const d=v(e);let f=oi(i,d,t.serverCache);null==f&&t.serverCache.isCompleteForChild(d)&&(f=c.getImmediateChild(d)),h=null!=f?n.filter.updateChild(c,d,f,A(e),a,r):t.eventCache.getNode().hasChild(d)?n.filter.updateChild(c,d,m.EMPTY_NODE,A(e),a,r):c,h.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=zt(i,Ne(t)),o.isLeafNode()&&(h=n.filter.updateFullNode(h,o,r)))}return o=t.serverCache.isFullyInitialized()||null!=Kt(i,b()),ht(t,h,o,n.filter.filtersNodes())}}(n,t,h.path,i,s,r):function Gc(n,t,e,i,s,r,o){if(null!=Kt(s,e))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=i.value){if(C(e)&&c.isFullyInitialized()||c.isCompleteForPath(e))return Zt(n,t,e,c.getNode().getChild(e),s,r,a,o);if(C(e)){let h=new I(null);return c.getNode().forEachChild(K,(d,f)=>{h=h.set(new S(d),f)}),ci(n,t,e,h,s,r,a,o)}return t}{let h=new I(null);return i.foreach((d,f)=>{const p=D(e,d);c.isCompleteForPath(p)&&(h=h.set(d,c.getNode().getChild(p)))}),ci(n,t,e,h,s,r,a,o)}}(n,t,h.path,h.affectedTree,i,s,r)}else{if(e.type!==Z.LISTEN_COMPLETE)throw(0,u.g5)("Unknown operation type: "+e.type);o=function Uc(n,t,e,i,s){const r=t.serverCache;return Sr(n,pr(t,r.getNode(),r.isFullyInitialized()||C(e),r.isFiltered()),e,i,br,s)}(n,t,e.path,i,r)}const c=r.getChanges();return function Lc(n,t,e){const i=t.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Qt(n);(e.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&e.push(ur(Qt(t)))}}(t,o,c),{viewCache:o,changes:c}}(n.processor_,s,t,e,i);return function Vc(n,t){(0,u.hu)(t.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),(0,u.hu)(t.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,r.viewCache),(0,u.hu)(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Mr(n,r.changes,r.viewCache.eventCache.getNode(),null)}function Mr(n,t,e,i){return function _c(n,t,e,i){const s=[],r=[];return t.forEach(o=>{"child_changed"===o.type&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(function tc(n,t){return{type:"child_moved",snapshotNode:t,childName:n}}(o.childName,o.snapshotNode))}),ut(n,s,"child_removed",t,i,e),ut(n,s,"child_added",t,i,e),ut(n,s,"child_moved",r,i,e),ut(n,s,"child_changed",t,i,e),ut(n,s,"value",t,i,e),s}(n.eventGenerator_,t,e,i?[i]:n.eventRegistrations_)}let Jt,en;class xr{constructor(){this.views=new Map}}function ui(n,t,e,i){const s=t.source.queryId;if(null!==s){const r=n.views.get(s);return(0,u.hu)(null!=r,"SyncTree gave us an op for an invalid query."),Nr(r,t,e,i)}{let r=[];for(const o of n.views.values())r=r.concat(Nr(o,t,e,i));return r}}function Or(n,t,e,i,s){const o=n.views.get(t._queryIdentifier);if(!o){let a=zt(e,s?i:null),c=!1;a?c=!0:i instanceof m?(a=ri(e,i),c=!1):(a=m.EMPTY_NODE,c=!1);const h=qt(new ue(a,c,!1),new ue(i,s,!1));return new Hc(t,h)}return o}function Pr(n){const t=[];for(const e of n.views.values())e.query._queryParams.loadsAllData()||t.push(e);return t}function de(n,t){let e=null;for(const i of n.views.values())e=e||qc(i,t);return e}function Rr(n,t){return t._queryParams.loadsAllData()?Xt(n):n.views.get(t._queryIdentifier)}function kr(n,t){return null!=Rr(n,t)}function fe(n){return null!=Xt(n)}function Xt(n){for(const t of n.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let nu=1;class Vr{constructor(t){this.listenProvider_=t,this.syncPointTree_=new I(null),this.pendingWriteTree_=function xc(){return{visibleWrites:q.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function hi(n,t,e,i,s){return function vc(n,t,e,i,s){(0,u.hu)(i>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),n.allWrites.push({path:t,snap:e,writeId:i,visible:s}),s&&(n.visibleWrites=dt(n.visibleWrites,t,e)),n.lastWriteId=i}(n.pendingWriteTree_,t,e,i,s),s?Ye(n,new De({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,e)):[]}function pe(n,t,e=!1){const i=function wc(n,t){for(let e=0;e<n.allWrites.length;e++){const i=n.allWrites[e];if(i.writeId===t)return i}return null}(n.pendingWriteTree_,t);if(function Ec(n,t){const e=n.allWrites.findIndex(a=>a.writeId===t);(0,u.hu)(e>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[e];n.allWrites.splice(e,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=e&&bc(a,i.path)?s=!1:W(i.path,a.path)&&(r=!0)),o--}return!!s&&(r?(function Sc(n){n.visibleWrites=yr(n.allWrites,Ac,b()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(i.snap?n.visibleWrites=_r(n.visibleWrites,i.path):x(i.children,c=>{n.visibleWrites=_r(n.visibleWrites,D(i.path,c))}),!0))}(n.pendingWriteTree_,t)){let r=new I(null);return null!=i.snap?r=r.set(b(),!0):x(i.children,o=>{r=r.set(new S(o),!0)}),Ye(n,new Yt(i.path,r,e))}return[]}function ft(n,t,e){return Ye(n,new De({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,e))}function tn(n,t,e,i,s=!1){const r=t._path,o=n.syncPointTree_.get(r);let a=[];if(o&&("default"===t._queryIdentifier||kr(o,t))){const c=function Xc(n,t,e,i){const s=t._queryIdentifier,r=[];let o=[];const a=fe(n);if("default"===s)for(const[c,h]of n.views.entries())o=o.concat(Dr(h,e,i)),Ir(h)&&(n.views.delete(c),h.query._queryParams.loadsAllData()||r.push(h.query));else{const c=n.views.get(s);c&&(o=o.concat(Dr(c,e,i)),Ir(c)&&(n.views.delete(s),c.query._queryParams.loadsAllData()||r.push(c.query)))}return a&&!fe(n)&&r.push(new(function Kc(){return(0,u.hu)(Jt,"Reference.ts has not been loaded"),Jt}())(t._repo,t._path)),{removed:r,events:o}}(o,t,e,i);(function Zc(n){return 0===n.views.size})(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const h=c.removed;if(a=c.events,!s){const d=-1!==h.findIndex(p=>p._queryParams.loadsAllData()),f=n.syncPointTree_.findOnPath(r,(p,_)=>fe(_));if(d&&!f){const p=n.syncPointTree_.subtree(r);if(!p.isEmpty()){const _=function cu(n){return n.fold((t,e,i)=>{if(e&&fe(e))return[Xt(e)];{let s=[];return e&&(s=Pr(e)),x(i,(r,o)=>{s=s.concat(o)}),s}})}(p);for(let g=0;g<_.length;++g){const E=_[g],O=E.query,ee=Gr(n,E);n.listenProvider_.startListening(_t(O),pt(n,O),ee.hashFn,ee.onComplete)}}}!f&&h.length>0&&!i&&(d?n.listenProvider_.stopListening(_t(t),null):h.forEach(p=>{const _=n.queryToTagMap.get(sn(p));n.listenProvider_.stopListening(_t(p),_)}))}!function uu(n,t){for(let e=0;e<t.length;++e){const i=t[e];if(!i._queryParams.loadsAllData()){const s=sn(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}(n,h)}return a}function Fr(n,t,e,i){const s=fi(n,i);if(null!=s){const r=pi(s),o=r.path,a=r.queryId,c=V(o,t);return _i(n,o,new De(ei(a),c,e))}return[]}function di(n,t,e,i=!1){const s=t._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(p,_)=>{const g=V(p,s);r=r||de(_,g),o=o||fe(_)});let c,a=n.syncPointTree_.get(s);a?(o=o||fe(a),r=r||de(a,b())):(a=new xr,n.syncPointTree_=n.syncPointTree_.set(s,a)),null!=r?c=!0:(c=!1,r=m.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((_,g)=>{const E=de(g,b());E&&(r=r.updateImmediateChild(_,E))}));const h=kr(a,t);if(!h&&!t._queryParams.loadsAllData()){const p=sn(t);(0,u.hu)(!n.queryToTagMap.has(p),"View does not exist, but we have a tag");const _=function hu(){return nu++}();n.queryToTagMap.set(p,_),n.tagToQueryMap.set(_,p)}let f=function Jc(n,t,e,i,s,r){const o=Or(n,t,i,s,r);return n.views.has(t._queryIdentifier)||n.views.set(t._queryIdentifier,o),function Qc(n,t){n.eventRegistrations_.push(t)}(o,e),function $c(n,t){const e=n.viewCache_.eventCache,i=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(T,(r,o)=>{i.push(Ue(r,o))}),e.isFullyInitialized()&&i.push(ur(e.getNode())),Mr(n,i,e.getNode(),t)}(o,e)}(a,t,e,$t(n.pendingWriteTree_,s),r,c);if(!h&&!o&&!i){const p=Rr(a,t);f=f.concat(function du(n,t,e){const i=t._path,s=pt(n,t),r=Gr(n,e),o=n.listenProvider_.startListening(_t(t),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)(0,u.hu)(!fe(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((h,d,f)=>{if(!C(h)&&d&&fe(d))return[Xt(d).query];{let p=[];return d&&(p=p.concat(Pr(d).map(_=>_.query))),x(f,(_,g)=>{p=p.concat(g)}),p}});for(let h=0;h<c.length;++h){const d=c[h];n.listenProvider_.stopListening(_t(d),pt(n,d))}}return o}(n,t,p))}return f}function nn(n,t,e){const s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(t,(o,a)=>{const h=de(a,V(o,t));if(h)return h});return vr(s,t,r,e,!0)}function Ye(n,t){return Lr(t,n.syncPointTree_,null,$t(n.pendingWriteTree_,b()))}function Lr(n,t,e,i){if(C(n.path))return Br(n,t,e,i);{const s=t.get(b());null==e&&null!=s&&(e=de(s,b()));let r=[];const o=v(n.path),a=n.operationForChild(o),c=t.children.get(o);if(c&&a){const h=e?e.getImmediateChild(o):null,d=wr(i,o);r=r.concat(Lr(a,c,h,d))}return s&&(r=r.concat(ui(s,n,i,e))),r}}function Br(n,t,e,i){const s=t.get(b());null==e&&null!=s&&(e=de(s,b()));let r=[];return t.children.inorderTraversal((o,a)=>{const c=e?e.getImmediateChild(o):null,h=wr(i,o),d=n.operationForChild(o);d&&(r=r.concat(Br(d,a,c,h)))}),s&&(r=r.concat(ui(s,n,i,e))),r}function Gr(n,t){const e=t.query,i=pt(n,e);return{hashFn:()=>(function jc(n){return n.viewCache_.serverCache.getNode()}(t)||m.EMPTY_NODE).hash(),onComplete:s=>{if("ok"===s)return i?function ou(n,t,e){const i=fi(n,e);if(i){const s=pi(i),r=s.path,o=s.queryId,a=V(r,t);return _i(n,r,new ct(ei(o),a))}return[]}(n,e._path,i):function ru(n,t){return Ye(n,new ct({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(n,e._path);{const r=function sl(n,t){let e="Unknown Error";"too_big"===n?e="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?e="Client doesn't have permission to access the desired data.":"unavailable"===n&&(e="The service is unavailable");const i=new Error(n+" at "+t._path.toString()+": "+e);return i.code=n.toUpperCase(),i}(s,e);return tn(n,e,null,r)}}}}function pt(n,t){const e=sn(t);return n.queryToTagMap.get(e)}function sn(n){return n._path.toString()+"$"+n._queryIdentifier}function fi(n,t){return n.tagToQueryMap.get(t)}function pi(n){const t=n.indexOf("$");return(0,u.hu)(-1!==t&&t<n.length-1,"Bad queryKey."),{queryId:n.substr(t+1),path:new S(n.substr(0,t))}}function _i(n,t,e){const i=n.syncPointTree_.get(t);return(0,u.hu)(i,"Missing sync point for query tag that we're tracking"),ui(i,e,$t(n.pendingWriteTree_,t),null)}function _t(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(function tu(){return(0,u.hu)(en,"Reference.ts has not been loaded"),en}())(n._repo,n._path):n}class gi{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new gi(e)}node(){return this.node_}}class mi{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=D(this.path_,t);return new mi(this.syncTree_,e)}node(){return nn(this.syncTree_,this.path_)}}const fu=function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n},Ur=function(n,t,e){return n&&"object"==typeof n?((0,u.hu)(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?pu(n[".sv"],t,e):"object"==typeof n[".sv"]?_u(n[".sv"],t):void(0,u.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},pu=function(n,t,e){if("timestamp"===n)return e.timestamp;(0,u.hu)(!1,"Unexpected server value: "+n)},_u=function(n,t,e){n.hasOwnProperty("increment")||(0,u.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;"number"!=typeof i&&(0,u.hu)(!1,"Unexpected increment value: "+i);const s=t.node();if((0,u.hu)(null!==s&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return"number"!=typeof o?i:o+i},Wr=function(n,t,e,i){return vi(t,new mi(e,n),i)},yi=function(n,t,e){return vi(n,new gi(t),e)};function vi(n,t,e){const i=n.getPriority().val(),s=Ur(i,t.getImmediateChild(".priority"),e);let r;if(n.isLeafNode()){const o=n,a=Ur(o.getValue(),t,e);return a!==o.getValue()||s!==o.getPriority().val()?new Be(a,N(s)):n}{const o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Be(s))),o.forEachChild(T,(a,c)=>{const h=vi(c,t.getImmediateChild(a),e);h!==c&&(r=r.updateImmediateChild(a,h))}),r}}class Ci{constructor(t="",e=null,i={children:{},childCount:0}){this.name=t,this.parent=e,this.node=i}}function rn(n,t){let e=t instanceof S?t:new S(t),i=n,s=v(e);for(;null!==s;){const r=(0,u.DV)(i.node.children,s)||{children:{},childCount:0};i=new Ci(s,i,r),e=A(e),s=v(e)}return i}function xe(n){return n.node.value}function wi(n,t){n.node.value=t,Ei(n)}function Hr(n){return n.node.childCount>0}function on(n,t){x(n.node.children,(e,i)=>{t(new Ci(e,n,i))})}function jr(n,t,e,i){e&&!i&&t(n),on(n,s=>{jr(s,t,!0,i)}),e&&i&&t(n)}function gt(n){return new S(null===n.parent?n.name:gt(n.parent)+"/"+n.name)}function Ei(n){null!==n.parent&&function yu(n,t,e){const i=function gu(n){return void 0===xe(n)&&!Hr(n)}(e),s=(0,u.r3)(n.node.children,t);i&&s?(delete n.node.children[t],n.node.childCount--,Ei(n)):!i&&!s&&(n.node.children[t]=e.node,n.node.childCount++,Ei(n))}(n.parent,n.name,n)}const vu=/[\[\].#$\/\u0000-\u001F\u007F]/,Cu=/[\[\].#$\u0000-\u001F\u007F]/,bi=10485760,an=function(n){return"string"==typeof n&&0!==n.length&&!vu.test(n)},Yr=function(n){return"string"==typeof n&&0!==n.length&&!Cu.test(n)},mt=function(n){return null===n||"string"==typeof n||"number"==typeof n&&!Pt(n)||n&&"object"==typeof n&&(0,u.r3)(n,".sv")},J=function(n,t,e,i){i&&void 0===t||yt((0,u.gK)(n,"value"),t,e)},yt=function(n,t,e){const i=e instanceof S?new Fl(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+Te(i));if("function"==typeof t)throw new Error(n+"contains a function "+Te(i)+" with contents = "+t.toString());if(Pt(t))throw new Error(n+"contains "+t.toString()+" "+Te(i));if("string"==typeof t&&t.length>bi/3&&(0,u.ug)(t)>bi)throw new Error(n+"contains a string greater than "+bi+" utf8 bytes "+Te(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let s=!1,r=!1;if(x(t,(o,a)=>{if(".value"===o)s=!0;else if(".priority"!==o&&".sv"!==o&&(r=!0,!an(o)))throw new Error(n+" contains an invalid key ("+o+") "+Te(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function Ll(n,t){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(t),n.byteLength_+=(0,u.ug)(t),tr(n)})(i,o),yt(n,a,i),function Bl(n){const t=n.parts_.pop();n.byteLength_-=(0,u.ug)(t),n.parts_.length>0&&(n.byteLength_-=1)}(i)}),s&&r)throw new Error(n+' contains ".value" child '+Te(i)+" in addition to actual children.")}},qr=function(n,t,e,i){if(i&&void 0===t)return;const s=(0,u.gK)(n,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(s+" must be an object containing the children to replace.");const r=[];x(t,(o,a)=>{const c=new S(o);if(yt(s,a,D(e,c)),".priority"===Bn(c)&&!mt(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(c)}),function(n,t){let e,i;for(e=0;e<t.length;e++){i=t[e];const r=nt(i);for(let o=0;o<r.length;o++)if((".priority"!==r[o]||o!==r.length-1)&&!an(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(Vl);let s=null;for(e=0;e<t.length;e++){if(i=t[e],null!==s&&W(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}}(s,r)},Si=function(n,t,e){if(!e||void 0!==t){if(Pt(t))throw new Error((0,u.gK)(n,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!mt(t))throw new Error((0,u.gK)(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},vt=function(n,t,e,i){if(!(i&&void 0===e||an(e)))throw new Error((0,u.gK)(n,t)+'was an invalid key = "'+e+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Ct=function(n,t,e,i){if(!(i&&void 0===e||Yr(e)))throw new Error((0,u.gK)(n,t)+'was an invalid path = "'+e+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},bu=function(n,t,e,i){e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Ct(n,t,e,i)},H=function(n,t){if(".info"===v(t))throw new Error(n+" failed = Can't modify data under /.info/")},Qr=function(n,t){const e=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!an(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==e.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Yr(n)}(e))throw new Error((0,u.gK)(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Su{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ln(n,t){let e=null;for(let i=0;i<t.length;i++){const s=t[i],r=s.getPath();null!==e&&!Gn(r,e.path)&&(n.eventLists_.push(e),e=null),null===e&&(e={events:[],path:r}),e.events.push(s)}e&&n.eventLists_.push(e)}function $r(n,t,e){ln(n,e),zr(n,i=>Gn(i,t))}function G(n,t,e){ln(n,e),zr(n,i=>W(i,t)||W(t,i))}function zr(n,t){n.recursionDepth_++;let e=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];s&&(t(s.path)?(Au(n.eventLists_[i]),n.eventLists_[i]=null):e=!1)}e&&(n.eventLists_=[]),n.recursionDepth_--}function Au(n){for(let t=0;t<n.events.length;t++){const e=n.events[t];if(null!==e){n.events[t]=null;const i=e.getEventRunner();Se&&M("event: "+e.toString()),Fe(i)}}}const Kr="repo_interrupt",Tu=25;class Iu{constructor(t,e,i,s){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Su,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=jt(),this.transactionQueueTree_=new Ci,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Zr(n){const e=n.infoData_.getNode(new S(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e}function wt(n){return fu({timestamp:Zr(n)})}function Jr(n,t,e,i,s){n.dataUpdateCount++;const r=new S(t);e=n.interceptServerDataCallback_?n.interceptServerDataCallback_(t,e):e;let o=[];if(s)if(i){const c=(0,u.UI)(e,h=>N(h));o=function au(n,t,e,i){const s=fi(n,i);if(s){const r=pi(s),o=r.path,a=r.queryId,c=V(o,t),h=I.fromObject(e);return _i(n,o,new He(ei(a),c,h))}return[]}(n.serverSyncTree_,r,c,s)}else{const c=N(e);o=Fr(n.serverSyncTree_,r,c,s)}else if(i){const c=(0,u.UI)(e,h=>N(h));o=function su(n,t,e){const i=I.fromObject(e);return Ye(n,new He({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(n.serverSyncTree_,r,c)}else{const c=N(e);o=ft(n.serverSyncTree_,r,c)}let a=r;o.length>0&&(a=Qe(n,r)),G(n.eventQueue_,a,o)}function Xr(n,t){Ai(n,"connected",t),!1===t&&function Ou(n){qe(n,"onDisconnectEvents");const t=wt(n),e=jt();Zn(n.onDisconnect_,b(),(s,r)=>{const o=Wr(s,r,n.serverSyncTree_,t);We(e,s,o)});let i=[];Zn(e,b(),(s,r)=>{i=i.concat(ft(n.serverSyncTree_,s,r));const o=Ni(n,s);Qe(n,o)}),n.onDisconnect_=jt(),G(n.eventQueue_,b(),i)}(n)}function Ai(n,t,e){const i=new S("/.info/"+t),s=N(e);n.infoData_.updateSnapshot(i,s);const r=ft(n.infoSyncTree_,i,s);G(n.eventQueue_,i,r)}function cn(n){return n.nextWriteId_++}function Ti(n,t,e,i,s){qe(n,"set",{path:t.toString(),value:e,priority:i});const r=wt(n),o=N(e,i),a=nn(n.serverSyncTree_,t),c=yi(o,a,r),h=cn(n),d=hi(n.serverSyncTree_,t,c,h,!0);ln(n.eventQueue_,d),n.server_.put(t.toString(),o.val(!0),(p,_)=>{const g="ok"===p;g||R("set at "+t+" failed: "+p);const E=pe(n.serverSyncTree_,h,!g);G(n.eventQueue_,t,E),_e(0,s,p,_)});const f=Ni(n,t);Qe(n,f),G(n.eventQueue_,f,[])}function Pu(n,t,e){n.server_.onDisconnectCancel(t.toString(),(i,s)=>{"ok"===i&&Kn(n.onDisconnect_,t),_e(0,e,i,s)})}function eo(n,t,e,i){const s=N(e);n.server_.onDisconnectPut(t.toString(),s.val(!0),(r,o)=>{"ok"===r&&We(n.onDisconnect_,t,s),_e(0,i,r,o)})}function Ii(n,t,e){let i;i=".info"===v(t._path)?tn(n.infoSyncTree_,t,e):tn(n.serverSyncTree_,t,e),$r(n.eventQueue_,t._path,i)}function to(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Kr)}function qe(n,...t){let e="";n.persistentConnection_&&(e=n.persistentConnection_.id+":"),M(e,...t)}function _e(n,t,e,i){t&&Fe(()=>{if("ok"===e)t(null);else{const s=(e||"error").toUpperCase();let r=s;i&&(r+=": "+i);const o=new Error(r);o.code=s,t(o)}})}function Di(n,t,e){return nn(n.serverSyncTree_,t,e)||m.EMPTY_NODE}function un(n,t=n.transactionQueueTree_){if(t||hn(n,t),xe(t)){const e=io(n,t);(0,u.hu)(e.length>0,"Sending zero length transaction queue"),e.every(s=>0===s.status)&&function Bu(n,t,e){const i=e.map(h=>h.currentWriteId),s=Di(n,t,i);let r=s;const o=s.hash();for(let h=0;h<e.length;h++){const d=e[h];(0,u.hu)(0===d.status,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const f=V(t,d.path);r=r.updateChild(f,d.currentOutputSnapshotRaw)}const a=r.val(!0),c=t;n.server_.put(c.toString(),a,h=>{qe(n,"transaction put response",{path:c.toString(),status:h});let d=[];if("ok"===h){const f=[];for(let p=0;p<e.length;p++)e[p].status=2,d=d.concat(pe(n.serverSyncTree_,e[p].currentWriteId)),e[p].onComplete&&f.push(()=>e[p].onComplete(null,!0,e[p].currentOutputSnapshotResolved)),e[p].unwatcher();hn(n,rn(n.transactionQueueTree_,t)),un(n,n.transactionQueueTree_),G(n.eventQueue_,t,d);for(let p=0;p<f.length;p++)Fe(f[p])}else{if("datastale"===h)for(let f=0;f<e.length;f++)e[f].status=3===e[f].status?4:0;else{R("transaction at "+c.toString()+" failed: "+h);for(let f=0;f<e.length;f++)e[f].status=4,e[f].abortReason=h}Qe(n,t)}},o)}(n,gt(t),e)}else Hr(t)&&on(t,e=>{un(n,e)})}function Qe(n,t){const e=no(n,t),i=gt(e);return function Gu(n,t,e){if(0===t.length)return;const i=[];let s=[];const o=t.filter(a=>0===a.status).map(a=>a.currentWriteId);for(let a=0;a<t.length;a++){const c=t[a],h=V(e,c.path);let f,d=!1;if((0,u.hu)(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)d=!0,f=c.abortReason,s=s.concat(pe(n.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=Tu)d=!0,f="maxretry",s=s.concat(pe(n.serverSyncTree_,c.currentWriteId,!0));else{const p=Di(n,c.path,o);c.currentInputSnapshot=p;const _=t[a].update(p.val());if(void 0!==_){yt("transaction failed: Data returned ",_,c.path);let g=N(_);"object"==typeof _&&null!=_&&(0,u.r3)(_,".priority")||(g=g.updatePriority(p.getPriority()));const O=c.currentWriteId,ee=wt(n),ie=yi(g,p,ee);c.currentOutputSnapshotRaw=g,c.currentOutputSnapshotResolved=ie,c.currentWriteId=cn(n),o.splice(o.indexOf(O),1),s=s.concat(hi(n.serverSyncTree_,c.path,ie,c.currentWriteId,c.applyLocally)),s=s.concat(pe(n.serverSyncTree_,O,!0))}else d=!0,f="nodata",s=s.concat(pe(n.serverSyncTree_,c.currentWriteId,!0))}G(n.eventQueue_,e,s),s=[],d&&(t[a].status=2,setTimeout(t[a].unwatcher,Math.floor(0)),t[a].onComplete&&i.push("nodata"===f?()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot):()=>t[a].onComplete(new Error(f),!1,null)))}hn(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Fe(i[a]);un(n,n.transactionQueueTree_)}(n,io(n,e),i),i}function no(n,t){let e,i=n.transactionQueueTree_;for(e=v(t);null!==e&&void 0===xe(i);)i=rn(i,e),e=v(t=A(t));return i}function io(n,t){const e=[];return so(n,t,e),e.sort((i,s)=>i.order-s.order),e}function so(n,t,e){const i=xe(t);if(i)for(let s=0;s<i.length;s++)e.push(i[s]);on(t,s=>{so(n,s,e)})}function hn(n,t){const e=xe(t);if(e){let i=0;for(let s=0;s<e.length;s++)2!==e[s].status&&(e[i]=e[s],i++);e.length=i,wi(t,e.length>0?e:void 0)}on(t,i=>{hn(n,i)})}function Ni(n,t){const e=gt(no(n,t)),i=rn(n.transactionQueueTree_,t);return function mu(n,t,e){let i=e?n:n.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,s=>{Mi(n,s)}),Mi(n,i),jr(i,s=>{Mi(n,s)}),e}function Mi(n,t){const e=xe(t);if(e){const i=[];let s=[],r=-1;for(let o=0;o<e.length;o++)3===e[o].status||(1===e[o].status?((0,u.hu)(r===o-1,"All SENT items should be at beginning of queue."),r=o,e[o].status=3,e[o].abortReason="set"):((0,u.hu)(0===e[o].status,"Unexpected transaction status in abort"),e[o].unwatcher(),s=s.concat(pe(n.serverSyncTree_,e[o].currentWriteId,!0)),e[o].onComplete&&i.push(e[o].onComplete.bind(null,new Error("set"),!1,null))));-1===r?wi(t,void 0):e.length=r+1,G(n.eventQueue_,gt(t),s);for(let o=0;o<i.length;o++)Fe(i[o])}}const xi=function(n,t){const e=Hu(n),i=e.namespace;return"firebase.com"===e.domain&&z(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||"undefined"===i)&&"localhost"!==e.domain&&z("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||typeof window<"u"&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&R("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Pn(e.host,e.secure,i,"ws"===e.scheme||"wss"===e.scheme,t,"",i!==e.subdomain),path:new S(e.pathString)}},Hu=function(n){let t="",e="",i="",s="",r="",o=!0,a="https",c=443;if("string"==typeof n){let h=n.indexOf("//");h>=0&&(a=n.substring(0,h-1),n=n.substring(h+2));let d=n.indexOf("/");-1===d&&(d=n.length);let f=n.indexOf("?");-1===f&&(f=n.length),t=n.substring(0,Math.min(d,f)),d<f&&(s=function Uu(n){let t="";const e=n.split("/");for(let i=0;i<e.length;i++)if(e[i].length>0){let s=e[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}t+="/"+s}return t}(n.substring(d,f)));const p=function Wu(n){const t={};"?"===n.charAt(0)&&(n=n.substring(1));for(const e of n.split("&")){if(0===e.length)continue;const i=e.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):R(`Invalid query segment '${e}' in query '${n}'`)}return t}(n.substring(Math.min(n.length,f)));h=t.indexOf(":"),h>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(h+1),10)):h=t.length;const _=t.slice(0,h);if("localhost"===_.toLowerCase())e="localhost";else if(_.split(".").length<=2)e=_;else{const g=t.indexOf(".");i=t.substring(0,g).toLowerCase(),e=t.substring(g+1),r=i}"ns"in p&&(r=p.ns)}return{host:t,port:c,domain:e,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}},ro="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ju=function(){let n=0;const t=[];return function(e){const i=e===n;let s;n=e;const r=new Array(8);for(s=7;s>=0;s--)r[s]=ro.charAt(e%64),e=Math.floor(e/64);(0,u.hu)(0===e,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&63===t[s];s--)t[s]=0;t[s]++}else for(s=0;s<12;s++)t[s]=Math.floor(64*Math.random());for(s=0;s<12;s++)o+=ro.charAt(t[s]);return(0,u.hu)(20===o.length,"nextPushId: Length should be 20."),o}}();class oo{constructor(t,e,i,s){this.eventType=t,this.eventRegistration=e,this.snapshot=i,this.prevName=s}getPath(){const t=this.snapshot.ref;return"value"===this.eventType?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,u.Wl)(this.snapshot.exportVal())}}class ao{constructor(t,e,i){this.eventRegistration=t,this.error=e,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Oi{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return(0,u.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}class lo{constructor(t,e){this._repo=t,this._path=e}cancel(){const t=new u.BH;return Pu(this._repo,this._path,t.wrapCallback(()=>{})),t.promise}remove(){H("OnDisconnect.remove",this._path);const t=new u.BH;return eo(this._repo,this._path,null,t.wrapCallback(()=>{})),t.promise}set(t){H("OnDisconnect.set",this._path),J("OnDisconnect.set",t,this._path,!1);const e=new u.BH;return eo(this._repo,this._path,t,e.wrapCallback(()=>{})),e.promise}setWithPriority(t,e){H("OnDisconnect.setWithPriority",this._path),J("OnDisconnect.setWithPriority",t,this._path,!1),Si("OnDisconnect.setWithPriority",e,!1);const i=new u.BH;return function Ru(n,t,e,i,s){const r=N(e,i);n.server_.onDisconnectPut(t.toString(),r.val(!0),(o,a)=>{"ok"===o&&We(n.onDisconnect_,t,r),_e(0,s,o,a)})}(this._repo,this._path,t,e,i.wrapCallback(()=>{})),i.promise}update(t){H("OnDisconnect.update",this._path),qr("OnDisconnect.update",t,this._path,!1);const e=new u.BH;return function ku(n,t,e,i){if((0,u.xb)(e))return M("onDisconnect().update() called with empty data.  Don't do anything."),void _e(0,i,"ok",void 0);n.server_.onDisconnectMerge(t.toString(),e,(s,r)=>{"ok"===s&&x(e,(o,a)=>{const c=N(a);We(n.onDisconnect_,D(t,o),c)}),_e(0,i,s,r)})}(this._repo,this._path,t,e.wrapCallback(()=>{})),e.promise}}class B{constructor(t,e,i,s){this._repo=t,this._path=e,this._queryParams=i,this._orderByCalled=s}get key(){return C(this._path)?null:Bn(this._path)}get ref(){return new j(this._repo,this._path)}get _queryIdentifier(){const t=dr(this._queryParams),e=xn(t);return"{}"===e?"default":e}get _queryObject(){return dr(this._queryParams)}isEqual(t){if(!((t=(0,u.m9)(t))instanceof B))return!1;const e=this._repo===t._repo,i=Gn(this._path,t._path);return e&&i&&this._queryIdentifier===t._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function kl(n){let t="";for(let e=n.pieceNum_;e<n.pieces_.length;e++)""!==n.pieces_[e]&&(t+="/"+encodeURIComponent(String(n.pieces_[e])));return t||"/"}(this._path)}}function dn(n,t){if(!0===n._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function ge(n){let t=null,e=null;if(n.hasStart()&&(t=n.getIndexStartValue()),n.hasEnd()&&(e=n.getIndexEndValue()),n.getIndex()===K){const i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==ae)throw new Error(i);if("string"!=typeof t)throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==te)throw new Error(i);if("string"!=typeof e)throw new Error(s)}}else if(n.getIndex()===T){if(null!=t&&!mt(t)||null!=e&&!mt(e))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,u.hu)(n.getIndex()instanceof Yn||n.getIndex()===qn,"unknown index type."),null!=t&&"object"==typeof t||null!=e&&"object"==typeof e)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function fn(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class j extends B{constructor(t,e){super(t,e,new Ut,!1)}get parent(){const t=er(this._path);return null===t?null:new j(this._repo,t)}get root(){let t=this;for(;null!==t.parent;)t=t.parent;return t}}class Oe{constructor(t,e,i){this._node=t,this.ref=e,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new S(t),i=Pe(this.ref,t);return new Oe(this._node.getChild(e),i,T)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(i,s)=>t(new Oe(s,Pe(this.ref,i),T)))}hasChild(t){const e=new S(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function co(n,t){return(n=(0,u.m9)(n))._checkNotDeleted("ref"),void 0!==t?Pe(n._root,t):n._root}function uo(n,t){(n=(0,u.m9)(n))._checkNotDeleted("refFromURL");const e=xi(t,n._repo.repoInfo_.nodeAdmin);Qr("refFromURL",e);const i=e.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&z("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),co(n,e.path.toString())}function Pe(n,t){return null===v((n=(0,u.m9)(n))._path)?bu("child","path",t,!1):Ct("child","path",t,!1),new j(n._repo,D(n._path,t))}function Pi(n,t){n=(0,u.m9)(n),H("set",n._path),J("set",t,n._path,!1);const e=new u.BH;return Ti(n._repo,n._path,t,null,e.wrapCallback(()=>{})),e.promise}function zu(n,t){qr("update",t,n._path,!1);const e=new u.BH;return function xu(n,t,e,i){qe(n,"update",{path:t.toString(),value:e});let s=!0;const r=wt(n),o={};if(x(e,(a,c)=>{s=!1,o[a]=Wr(D(t,a),N(c),n.serverSyncTree_,r)}),s)M("update() called with empty data.  Don't do anything."),_e(0,i,"ok",void 0);else{const a=cn(n),c=function iu(n,t,e,i){!function Cc(n,t,e,i){(0,u.hu)(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:t,children:e,writeId:i,visible:!0}),n.visibleWrites=ni(n.visibleWrites,t,e),n.lastWriteId=i}(n.pendingWriteTree_,t,e,i);const s=I.fromObject(e);return Ye(n,new He({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,s))}(n.serverSyncTree_,t,o,a);ln(n.eventQueue_,c),n.server_.merge(t.toString(),e,(h,d)=>{const f="ok"===h;f||R("update at "+t+" failed: "+h);const p=pe(n.serverSyncTree_,a,!f),_=p.length>0?Qe(n,t):t;G(n.eventQueue_,_,p),_e(0,i,h,d)}),x(e,h=>{const d=Ni(n,D(t,h));Qe(n,d)}),G(n.eventQueue_,t,[])}}(n._repo,n._path,t,e.wrapCallback(()=>{})),e.promise}function Ku(n){n=(0,u.m9)(n);const t=new Oi(()=>{}),e=new Et(t);return function Mu(n,t,e){const i=function lu(n,t){const e=t._path;let i=null;n.syncPointTree_.foreachOnPath(e,(h,d)=>{const f=V(h,e);i=i||de(d,f)});let s=n.syncPointTree_.get(e);s?i=i||de(s,b()):(s=new xr,n.syncPointTree_=n.syncPointTree_.set(e,s));const r=null!=i,o=r?new ue(i,!0,!1):null;return function Yc(n){return Qt(n.viewCache_)}(Or(s,t,$t(n.pendingWriteTree_,t._path),r?o.getNode():m.EMPTY_NODE,r))}(n.serverSyncTree_,t);return null!=i?Promise.resolve(i):n.server_.get(t).then(s=>{const r=N(s).withIndex(t._queryParams.getIndex());let o;if(di(n.serverSyncTree_,t,e,!0),t._queryParams.loadsAllData())o=ft(n.serverSyncTree_,t._path,r);else{const a=pt(n.serverSyncTree_,t);o=Fr(n.serverSyncTree_,t._path,r,a)}return G(n.eventQueue_,t._path,o),tn(n.serverSyncTree_,t,e,null,!0),r},s=>(qe(n,"get for query "+(0,u.Wl)(t)+" failed: "+s),Promise.reject(new Error(s))))}(n._repo,n,e).then(i=>new Oe(i,new j(n._repo,n._path),n._queryParams.getIndex()))}class Et{constructor(t){this.callbackContext=t}respondsTo(t){return"value"===t}createEvent(t,e){const i=e._queryParams.getIndex();return new oo("value",this,new Oe(t.snapshotNode,new j(e._repo,e._path),i))}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new ao(this,t,e):null}matches(t){return t instanceof Et&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class pn{constructor(t,e){this.eventType=t,this.callbackContext=e}respondsTo(t){let e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,this.eventType===e}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new ao(this,t,e):null}createEvent(t,e){(0,u.hu)(null!=t.childName,"Child events should have a childName.");const i=Pe(new j(e._repo,e._path),t.childName),s=e._queryParams.getIndex();return new oo(t.type,this,new Oe(t.snapshotNode,i,s),t.prevName)}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,t.prevName)}matches(t){return t instanceof pn&&this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function bt(n,t,e,i,s){let r;if("object"==typeof i&&(r=void 0,s=i),"function"==typeof i&&(r=i),s&&s.onlyOnce){const c=e,h=(d,f)=>{Ii(n._repo,n,a),c(d,f)};h.userCallback=e.userCallback,h.context=e.context,e=h}const o=new Oi(e,r||void 0),a="value"===t?new Et(o):new pn(t,o);return function Vu(n,t,e){let i;i=".info"===v(t._path)?di(n.infoSyncTree_,t,e):di(n.serverSyncTree_,t,e),$r(n.eventQueue_,t._path,i)}(n._repo,n,a),()=>Ii(n._repo,n,a)}function Ri(n,t,e,i){return bt(n,"value",t,e,i)}function ho(n,t,e,i){return bt(n,"child_added",t,e,i)}function fo(n,t,e,i){return bt(n,"child_changed",t,e,i)}function po(n,t,e,i){return bt(n,"child_moved",t,e,i)}function _o(n,t,e,i){return bt(n,"child_removed",t,e,i)}function go(n,t,e){let i=null;const s=e?new Oi(e):null;"value"===t?i=new Et(s):t&&(i=new pn(t,s)),Ii(n._repo,n,i)}class Q{}class mo extends Q{constructor(t,e){super(),this._value=t,this._key=e,this.type="endAt"}_apply(t){J("endAt",this._value,t._path,!0);const e=zn(t._queryParams,this._value,this._key);if(fn(e),ge(e),t._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new B(t._repo,t._path,e,t._orderByCalled)}}class Ju extends Q{constructor(t,e){super(),this._value=t,this._key=e,this.type="endBefore"}_apply(t){J("endBefore",this._value,t._path,!1);const e=function ac(n,t,e){let i;return i=zn(n,t,n.index_===K||e?e:ae),i.endBeforeSet_=!0,i}(t._queryParams,this._value,this._key);if(fn(e),ge(e),t._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new B(t._repo,t._path,e,t._orderByCalled)}}class yo extends Q{constructor(t,e){super(),this._value=t,this._key=e,this.type="startAt"}_apply(t){J("startAt",this._value,t._path,!0);const e=$n(t._queryParams,this._value,this._key);if(fn(e),ge(e),t._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new B(t._repo,t._path,e,t._orderByCalled)}}class th extends Q{constructor(t,e){super(),this._value=t,this._key=e,this.type="startAfter"}_apply(t){J("startAfter",this._value,t._path,!1);const e=function oc(n,t,e){let i;return i=$n(n,t,n.index_===K||e?e:te),i.startAfterSet_=!0,i}(t._queryParams,this._value,this._key);if(fn(e),ge(e),t._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new B(t._repo,t._path,e,t._orderByCalled)}}class ih extends Q{constructor(t){super(),this._limit=t,this.type="limitToFirst"}_apply(t){if(t._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new B(t._repo,t._path,function sc(n,t){const e=n.copy();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="l",e}(t._queryParams,this._limit),t._orderByCalled)}}class rh extends Q{constructor(t){super(),this._limit=t,this.type="limitToLast"}_apply(t){if(t._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new B(t._repo,t._path,function rc(n,t){const e=n.copy();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="r",e}(t._queryParams,this._limit),t._orderByCalled)}}class ah extends Q{constructor(t){super(),this._path=t,this.type="orderByChild"}_apply(t){dn(t,"orderByChild");const e=new S(this._path);if(C(e))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new Yn(e),s=Wt(t._queryParams,i);return ge(s),new B(t._repo,t._path,s,!0)}}class ch extends Q{constructor(){super(...arguments),this.type="orderByKey"}_apply(t){dn(t,"orderByKey");const e=Wt(t._queryParams,K);return ge(e),new B(t._repo,t._path,e,!0)}}class hh extends Q{constructor(){super(...arguments),this.type="orderByPriority"}_apply(t){dn(t,"orderByPriority");const e=Wt(t._queryParams,T);return ge(e),new B(t._repo,t._path,e,!0)}}class fh extends Q{constructor(){super(...arguments),this.type="orderByValue"}_apply(t){dn(t,"orderByValue");const e=Wt(t._queryParams,qn);return ge(e),new B(t._repo,t._path,e,!0)}}class _h extends Q{constructor(t,e){super(),this._value=t,this._key=e,this.type="equalTo"}_apply(t){if(J("equalTo",this._value,t._path,!1),t._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(t._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new mo(this._value,this._key)._apply(new yo(this._value,this._key)._apply(t))}}function $(n,...t){let e=(0,u.m9)(n);for(const i of t)e=i._apply(e);return e}(function zc(n){(0,u.hu)(!Jt,"__referenceConstructor has already been defined"),Jt=n})(j),function eu(n){(0,u.hu)(!en,"__referenceConstructor has already been defined"),en=n}(j);const ki={};function Vi(n,t,e,i,s){let r=i||n.options.databaseURL;void 0===r&&(n.options.projectId||z("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),M("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let c,h,o=xi(r,s),a=o.repoInfo;typeof process<"u"&&process.env&&(h=process.env.FIREBASE_DATABASE_EMULATOR_HOST),h?(c=!0,r=`http://${h}?ns=${a.namespace}`,o=xi(r,s),a=o.repoInfo):c=!o.repoInfo.secure;const d=s&&c?new tt(tt.OWNER):new ul(n.name,n.options,t);Qr("Invalid Firebase Database URL",o),C(o.path)||z("Database URL must point to the root of a Firebase Database (not including a child path).");const f=function Ch(n,t,e,i){let s=ki[t.name];s||(s={},ki[t.name]=s);let r=s[n.toURLString()];return r&&z("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Iu(n,false,e,i),s[n.toURLString()]=r,r}(a,n,d,new cl(n.name,e));return new Eh(f,n)}class Eh{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function Du(n,t,e){if(n.stats_=Vn(n.repoInfo_),n.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)n.server_=new Ht(n.repoInfo_,(i,s,r,o)=>{Jr(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Xr(n,!0),0);else{if(typeof e<"u"&&null!==e){if("object"!=typeof e)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,u.Wl)(e)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Ie(n.repoInfo_,t,(i,s,r,o)=>{Jr(n,i,s,r,o)},i=>{Xr(n,i)},i=>{!function Nu(n,t){x(t,(e,i)=>{Ai(n,e,i)})}(n,i)},n.authTokenProvider_,n.appCheckProvider_,e),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=function fl(n,t){const e=n.toString();return kn[e]||(kn[e]=t()),kn[e]}(n.repoInfo_,()=>new fc(n.stats_,n.server_)),n.infoData_=new lc,n.infoSyncTree_=new Vr({startListening:(i,s,r,o)=>{let a=[];const c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=ft(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Ai(n,"connected",!1),n.serverSyncTree_=new Vr({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,c)=>{const h=o(a,c);G(n.eventQueue_,i._path,h)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new j(this._repo,b())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function vh(n,t){const e=ki[t];(!e||e[n.key]!==n)&&z(`Database ${t}(${n.repoInfo_}) has already been deleted.`),to(n),delete e[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&z("Cannot call "+t+" on a deleted database.")}}function Co(){Ws.IS_TRANSPORT_INITIALIZED&&R("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function bh(){Co(),le.forceDisallow()}function Sh(){Co(),Le.forceDisallow(),le.forceAllow()}function Ih(n,t){Es(n,t)}const Nh={".sv":"timestamp"};class Oh{constructor(t,e){this.committed=t,this.snapshot=e}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}Ie.prototype.simpleListen=function(n,t){this.sendRequest("q",{p:n},t)},Ie.prototype.echo=function(n,t){this.sendRequest("echo",{d:n},t)},function Dh(n){Dn(Ot.SDK_VERSION),(0,Ot._registerComponent)(new Ee.wA("database",(t,{instanceIdentifier:e})=>Vi(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"),t.getProvider("app-check-internal"),e),"PUBLIC").setMultipleInstances(!0)),(0,Ot.registerVersion)(gs,"1.0.3",n),(0,Ot.registerVersion)(gs,"1.0.3","esm2017")}();const Vh=new Tn.Yd("@firebase/database-compat"),Eo=function(n){Vh.warn("FIREBASE WARNING: "+n)};class Bh{constructor(t){this._delegate=t}cancel(t){(0,u.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,u.Wj)("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),i=>t(i)),e}remove(t){(0,u.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,u.Wj)("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),i=>t(i)),e}set(t,e){(0,u.Dv)("OnDisconnect.set",1,2,arguments.length),(0,u.Wj)("OnDisconnect.set","onComplete",e,!0);const i=this._delegate.set(t);return e&&i.then(()=>e(null),s=>e(s)),i}setWithPriority(t,e,i){(0,u.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,u.Wj)("OnDisconnect.setWithPriority","onComplete",i,!0);const s=this._delegate.setWithPriority(t,e);return i&&s.then(()=>i(null),r=>i(r)),s}update(t,e){if((0,u.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const s={};for(let r=0;r<t.length;++r)s[""+r]=t[r];t=s,Eo("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,u.Wj)("OnDisconnect.update","onComplete",e,!0);const i=this._delegate.update(t);return e&&i.then(()=>e(null),s=>e(s)),i}}class Gh{constructor(t,e){this.committed=t,this.snapshot=e}toJSON(){return(0,u.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class me{constructor(t,e){this._database=t,this._delegate=e}val(){return(0,u.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return(0,u.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return(0,u.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return(0,u.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(t){return(0,u.Dv)("DataSnapshot.child",0,1,arguments.length),t=String(t),Ct("DataSnapshot.child","path",t,!1),new me(this._database,this._delegate.child(t))}hasChild(t){return(0,u.Dv)("DataSnapshot.hasChild",1,1,arguments.length),Ct("DataSnapshot.hasChild","path",t,!1),this._delegate.hasChild(t)}getPriority(){return(0,u.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return(0,u.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,u.Wj)("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new me(this._database,e)))}hasChildren(){return(0,u.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return(0,u.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return(0,u.Dv)("DataSnapshot.ref",0,0,arguments.length),new U(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class P{constructor(t,e){this.database=t,this._delegate=e}on(t,e,i,s){var r;(0,u.Dv)("Query.on",2,4,arguments.length),(0,u.Wj)("Query.on","callback",e,!1);const o=P.getCancelAndContextArgs_("Query.on",i,s),a=(h,d)=>{e.call(o.context,new me(this.database,h),d)};a.userCallback=e,a.context=o.context;const c=null===(r=o.cancel)||void 0===r?void 0:r.bind(o.context);switch(t){case"value":return Ri(this._delegate,a,c),e;case"child_added":return ho(this._delegate,a,c),e;case"child_removed":return _o(this._delegate,a,c),e;case"child_changed":return fo(this._delegate,a,c),e;case"child_moved":return po(this._delegate,a,c),e;default:throw new Error((0,u.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(t,e,i){if((0,u.Dv)("Query.off",0,3,arguments.length),function(n,t,e){if(void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,u.gK)("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}(0,t),(0,u.Wj)("Query.off","callback",e,!0),(0,u.lb)("Query.off","context",i,!0),e){const s=()=>{};s.userCallback=e,s.context=i,go(this._delegate,t,s)}else go(this._delegate,t)}get(){return Ku(this._delegate).then(t=>new me(this.database,t))}once(t,e,i,s){(0,u.Dv)("Query.once",1,4,arguments.length),(0,u.Wj)("Query.once","callback",e,!0);const r=P.getCancelAndContextArgs_("Query.once",i,s),o=new u.BH,a=(h,d)=>{const f=new me(this.database,h);e&&e.call(r.context,f,d),o.resolve(f)};a.userCallback=e,a.context=r.context;const c=h=>{r.cancel&&r.cancel.call(r.context,h),o.reject(h)};switch(t){case"value":Ri(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":ho(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":_o(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":fo(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":po(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error((0,u.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(t){return(0,u.Dv)("Query.limitToFirst",1,1,arguments.length),new P(this.database,$(this._delegate,function sh(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new ih(n)}(t)))}limitToLast(t){return(0,u.Dv)("Query.limitToLast",1,1,arguments.length),new P(this.database,$(this._delegate,function oh(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new rh(n)}(t)))}orderByChild(t){return(0,u.Dv)("Query.orderByChild",1,1,arguments.length),new P(this.database,$(this._delegate,function lh(n){if("$key"===n)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===n)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===n)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ct("orderByChild","path",n,!1),new ah(n)}(t)))}orderByKey(){return(0,u.Dv)("Query.orderByKey",0,0,arguments.length),new P(this.database,$(this._delegate,function uh(){return new ch}()))}orderByPriority(){return(0,u.Dv)("Query.orderByPriority",0,0,arguments.length),new P(this.database,$(this._delegate,function dh(){return new hh}()))}orderByValue(){return(0,u.Dv)("Query.orderByValue",0,0,arguments.length),new P(this.database,$(this._delegate,function ph(){return new fh}()))}startAt(t=null,e){return(0,u.Dv)("Query.startAt",0,2,arguments.length),new P(this.database,$(this._delegate,function eh(n=null,t){return vt("startAt","key",t,!0),new yo(n,t)}(t,e)))}startAfter(t=null,e){return(0,u.Dv)("Query.startAfter",0,2,arguments.length),new P(this.database,$(this._delegate,function nh(n,t){return vt("startAfter","key",t,!0),new th(n,t)}(t,e)))}endAt(t=null,e){return(0,u.Dv)("Query.endAt",0,2,arguments.length),new P(this.database,$(this._delegate,function Zu(n,t){return vt("endAt","key",t,!0),new mo(n,t)}(t,e)))}endBefore(t=null,e){return(0,u.Dv)("Query.endBefore",0,2,arguments.length),new P(this.database,$(this._delegate,function Xu(n,t){return vt("endBefore","key",t,!0),new Ju(n,t)}(t,e)))}equalTo(t,e){return(0,u.Dv)("Query.equalTo",1,2,arguments.length),new P(this.database,$(this._delegate,function gh(n,t){return vt("equalTo","key",t,!0),new _h(n,t)}(t,e)))}toString(){return(0,u.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return(0,u.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(t){if((0,u.Dv)("Query.isEqual",1,1,arguments.length),!(t instanceof P))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(t._delegate)}static getCancelAndContextArgs_(t,e,i){const s={cancel:void 0,context:void 0};if(e&&i)s.cancel=e,(0,u.Wj)(t,"cancel",s.cancel,!0),s.context=i,(0,u.lb)(t,"context",s.context,!0);else if(e)if("object"==typeof e&&null!==e)s.context=e;else{if("function"!=typeof e)throw new Error((0,u.gK)(t,"cancelOrContext")+" must either be a cancel callback or a context object.");s.cancel=e}return s}get ref(){return new U(this.database,new j(this._delegate._repo,this._delegate._path))}}class U extends P{constructor(t,e){super(t,new B(e._repo,e._path,new Ut,!1)),this.database=t,this._delegate=e}getKey(){return(0,u.Dv)("Reference.key",0,0,arguments.length),this._delegate.key}child(t){return(0,u.Dv)("Reference.child",1,1,arguments.length),"number"==typeof t&&(t=String(t)),new U(this.database,Pe(this._delegate,t))}getParent(){(0,u.Dv)("Reference.parent",0,0,arguments.length);const t=this._delegate.parent;return t?new U(this.database,t):null}getRoot(){return(0,u.Dv)("Reference.root",0,0,arguments.length),new U(this.database,this._delegate.root)}set(t,e){(0,u.Dv)("Reference.set",1,2,arguments.length),(0,u.Wj)("Reference.set","onComplete",e,!0);const i=Pi(this._delegate,t);return e&&i.then(()=>e(null),s=>e(s)),i}update(t,e){if((0,u.Dv)("Reference.update",1,2,arguments.length),Array.isArray(t)){const s={};for(let r=0;r<t.length;++r)s[""+r]=t[r];t=s,Eo("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}H("Reference.update",this._delegate._path),(0,u.Wj)("Reference.update","onComplete",e,!0);const i=zu(this._delegate,t);return e&&i.then(()=>e(null),s=>e(s)),i}setWithPriority(t,e,i){(0,u.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,u.Wj)("Reference.setWithPriority","onComplete",i,!0);const s=function $u(n,t,e){if(H("setWithPriority",n._path),J("setWithPriority",t,n._path,!1),Si("setWithPriority",e,!1),".length"===n.key||".keys"===n.key)throw"setWithPriority failed: "+n.key+" is a read-only object.";const i=new u.BH;return Ti(n._repo,n._path,t,e,i.wrapCallback(()=>{})),i.promise}(this._delegate,t,e);return i&&s.then(()=>i(null),r=>i(r)),s}remove(t){(0,u.Dv)("Reference.remove",0,1,arguments.length),(0,u.Wj)("Reference.remove","onComplete",t,!0);const e=function qu(n){return H("remove",n._path),Pi(n,null)}(this._delegate);return t&&e.then(()=>t(null),i=>t(i)),e}transaction(t,e,i){(0,u.Dv)("Reference.transaction",1,3,arguments.length),(0,u.Wj)("Reference.transaction","transactionUpdate",t,!1),(0,u.Wj)("Reference.transaction","onComplete",e,!0),function(n,t,e,i){if(void 0!==e&&"boolean"!=typeof e)throw new Error((0,u.gK)("Reference.transaction","applyLocally")+"must be a boolean.")}(0,0,i);const s=function Ph(n,t,e){var i;if(n=(0,u.m9)(n),H("Reference.transaction",n._path),".length"===n.key||".keys"===n.key)throw"Reference.transaction failed: "+n.key+" is a read-only object.";const s=null===(i=e?.applyLocally)||void 0===i||i,r=new u.BH,a=Ri(n,()=>{});return function Lu(n,t,e,i,s,r){qe(n,"transaction on "+t);const o={path:t,update:e,onComplete:i,status:null,order:vs(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Di(n,t,void 0);o.currentInputSnapshot=a;const c=o.update(a.val());if(void 0===c)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{yt("transaction failed: Data returned ",c,o.path),o.status=0;const h=rn(n.transactionQueueTree_,t),d=xe(h)||[];let f;d.push(o),wi(h,d),"object"==typeof c&&null!==c&&(0,u.r3)(c,".priority")?(f=(0,u.DV)(c,".priority"),(0,u.hu)(mt(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(nn(n.serverSyncTree_,t)||m.EMPTY_NODE).getPriority().val();const p=wt(n),_=N(c,f),g=yi(_,a,p);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=g,o.currentWriteId=cn(n);const E=hi(n.serverSyncTree_,t,g,o.currentWriteId,o.applyLocally);G(n.eventQueue_,t,E),un(n,n.transactionQueueTree_)}}(n._repo,n._path,t,(c,h,d)=>{let f=null;c?r.reject(c):(f=new Oe(d,new j(n._repo,n._path),T),r.resolve(new Oh(h,f)))},a,s),r.promise}(this._delegate,t,{applyLocally:i}).then(r=>new Gh(r.committed,new me(this.database,r.snapshot)));return e&&s.then(r=>e(null,r.committed,r.snapshot),r=>e(r,!1,null)),s}setPriority(t,e){(0,u.Dv)("Reference.setPriority",1,2,arguments.length),(0,u.Wj)("Reference.setPriority","onComplete",e,!0);const i=function Qu(n,t){n=(0,u.m9)(n),H("setPriority",n._path),Si("setPriority",t,!1);const e=new u.BH;return Ti(n._repo,D(n._path,".priority"),t,null,e.wrapCallback(()=>{})),e.promise}(this._delegate,t);return e&&i.then(()=>e(null),s=>e(s)),i}push(t,e){(0,u.Dv)("Reference.push",0,2,arguments.length),(0,u.Wj)("Reference.push","onComplete",e,!0);const i=function Yu(n,t){n=(0,u.m9)(n),H("push",n._path),J("push",t,n._path,!0);const e=Zr(n._repo),i=ju(e),s=Pe(n,i),r=Pe(n,i);let o;return o=null!=t?Pi(r,t).then(()=>r):Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}(this._delegate,t),s=i.then(o=>new U(this.database,o));e&&s.then(()=>e(null),o=>e(o));const r=new U(this.database,i);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return H("Reference.onDisconnect",this._delegate._path),new Bh(new lo(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class St{constructor(t,e){this._delegate=t,this.app=e,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:bh,forceLongPolling:Sh}}useEmulator(t,e,i={}){!function wo(n,t,e,i={}){(n=(0,u.m9)(n))._checkNotDeleted("useEmulator"),n._instanceStarted&&z("Cannot call useEmulator() after instance has already been initialized.");const s=n._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&z('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new tt(tt.OWNER);else if(i.mockUserToken){const o="string"==typeof i.mockUserToken?i.mockUserToken:(0,u.Sg)(i.mockUserToken,n.app.options.projectId);r=new tt(o)}!function yh(n,t,e,i){n.repoInfo_=new Pn(`${t}:${e}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}(s,t,e,r)}(this._delegate,t,e,i)}ref(t){if((0,u.Dv)("database.ref",0,1,arguments.length),t instanceof U){const e=uo(this._delegate,t.toString());return new U(this,e)}{const e=co(this._delegate,t);return new U(this,e)}}refFromURL(t){(0,u.Dv)("database.refFromURL",1,1,arguments.length);const i=uo(this._delegate,t);return new U(this,i)}goOffline(){return(0,u.Dv)("database.goOffline",0,0,arguments.length),function Ah(n){(n=(0,u.m9)(n))._checkNotDeleted("goOffline"),to(n._repo)}(this._delegate)}goOnline(){return(0,u.Dv)("database.goOnline",0,0,arguments.length),function Th(n){(n=(0,u.m9)(n))._checkNotDeleted("goOnline"),function Fu(n){n.persistentConnection_&&n.persistentConnection_.resume(Kr)}(n._repo)}(this._delegate)}}St.ServerValue={TIMESTAMP:function Mh(){return Nh}(),increment:n=>function xh(n){return{".sv":{increment:n}}}(n)};var Wh=Object.freeze({__proto__:null,initStandalone:function Uh({app:n,url:t,version:e,customAuthImpl:i,customAppCheckImpl:s,namespace:r,nodeAdmin:o=!1}){Dn(e);const a=new Ee.H0("database-standalone"),c=new Ee.zt("auth-internal",a);let h;return c.setComponent(new Ee.wA("auth-internal",()=>i,"PRIVATE")),s&&(h=new Ee.zt("app-check-internal",a),h.setComponent(new Ee.wA("app-check-internal",()=>s,"PRIVATE"))),{instance:new St(Vi(n,c,h,t,o),n),namespace:r}}});const Hh=St.ServerValue;function At(n,t,e="on",i=$a.z){return new ps.y(s=>{let r=null;return r=n[e](t,(o,a)=>{i.schedule(()=>{s.next({snapshot:o,prevKey:a})}),"once"===e&&i.schedule(()=>s.complete())},o=>{i.schedule(()=>s.error(o))}),"on"===e?{unsubscribe(){null!=r&&n.off(t,r)}}:{unsubscribe(){}}}).pipe((0,oe.U)(s=>{const{snapshot:r,prevKey:o}=s;let a=null;return r.exists()&&(a=r.key),{type:t,payload:r,prevKey:o,key:a}}),(0,Wa.B)())}function bo(n){return null==n}function So(n){return"function"==typeof n.set}function Ao(n,t){return So(t)?t:n.ref(t)}function To(n,t){if(function Yh(n){return"string"==typeof n}(n))return t.stringCase();if(So(n))return t.firebaseCase();if(function qh(n){return"function"==typeof n.exportVal}(n))return t.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof n)}function Io(n){return(bo(n)||0===n.length)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Do(n,t,e){const i=(t=Io(t)).map(s=>At(n,s,"on",e));return(0,_s.T)(...i)}function No(n,t){return function(i,s){return To(i,{stringCase:()=>n.child(i)[t](s),firebaseCase:()=>i[t](s),snapshotCase:()=>i.ref[t](s)})}}function Kh(n){return function(e){return e?To(e,{stringCase:()=>n.child(e).remove(),firebaseCase:()=>e.remove(),snapshotCase:()=>e.ref.remove()}):n.remove()}}function Mo(n,t){const e=n.length;for(let i=0;i<e;i++)if(n[i].payload.key===t)return i;return-1}function Xh(n,t){const{payload:e,prevKey:i,key:s}=t,r=Mo(n,s),o=function Jh(n,t){if(bo(t))return 0;{const e=Mo(n,t);return-1===e?n.length:e+1}}(n,i);switch(t.type){case"value":if(t.payload?.exists()){let a=null;t.payload.forEach(c=>{const h={payload:c,type:"value",prevKey:a,key:c.key};return a=c.key,n=[...n,h],!1})}return n;case"child_added":if(r>-1)(n[r-1]?.key||null)!==i&&(n=n.filter(c=>c.payload.key!==e.key)).splice(o,0,t);else{if(null==i)return[t,...n];(n=n.slice()).splice(o,0,t)}return n;case"child_removed":return n.filter(a=>a.payload.key!==e.key);case"child_changed":return n.map(a=>a.payload.key===s?t:a);case"child_moved":if(r>-1){const a=n.splice(r,1)[0];return(n=n.slice()).splice(o,0,a),n}return n;default:return n}}function xo(n,t,e){return function Zh(n,t,e){return At(n,"value","once",e).pipe((0,fs.w)(i=>{const s=[(0,as.of)(i)];return t.forEach(r=>s.push(At(n,r,"on",e))),(0,_s.T)(...s).pipe((0,cs.R)(Xh,[]))}),(0,Qa.x)())}(n,t=Io(t),e)}function Oo(n,t){return function(){return At(n,"value","on",t)}}!function jh(n){n.INTERNAL.registerComponent(new Ee.wA("database-compat",(t,{instanceIdentifier:e})=>{const i=t.getProvider("app-compat").getImmediate(),s=t.getProvider("database").getImmediate({identifier:e});return new St(s,i)},"PUBLIC").setServiceProps({Reference:U,Query:P,Database:St,DataSnapshot:me,enableLogging:Ih,INTERNAL:Wh,ServerValue:Hh}).setMultipleInstances(!0)),n.registerVersion("@firebase/database-compat","1.0.3")}(za.Z),y(7142);const nd=new l.OlP("angularfire2.realtimeDatabaseURL"),id=new l.OlP("angularfire2.database.use-emulator");let Po=(()=>{class n{schedulers;database;constructor(e,i,s,r,o,a,c,h,d,f,p,_,g,E,O){this.schedulers=a;const ee=c,ie=(0,Mt.on)(e,o,i);h&&(0,re.nw)(ie,o,d,p,_,g,f,E),this.database=(0,Mt.cc)(`${ie.name}.database.${s}`,"AngularFireDatabase",ie.name,()=>{const Ke=o.runOutsideAngular(()=>ie.database(s||void 0));return ee&&Ke.useEmulator(...ee),Ke},[ee])}list(e,i){const s=this.schedulers.ngZone.runOutsideAngular(()=>Ao(this.database,e));let r=s;return i&&(r=i(s)),function ed(n,t){const e=t.schedulers.outsideAngular,i=t.schedulers.ngZone.run(()=>n.ref);return{query:n,update:No(i,"update"),set:No(i,"set"),push:s=>i.push(s),remove:Kh(i),snapshotChanges:s=>xo(n,s,e).pipe(se.iC),stateChanges:s=>Do(n,s,e).pipe(se.iC),auditTrail:s=>function Qh(n,t,e){return function zh(n,t,e){return function $h(n,t){return At(n,"value","on",t).pipe((0,oe.U)(e=>{let i;return e.payload.forEach(s=>(i=s.key,!1)),{data:e,lastKeyToLoad:i}}))}(n,e).pipe(function Ya(...n){const t=(0,ds.jO)(n);return(0,us.e)((e,i)=>{const s=n.length,r=new Array(s);let o=n.map(()=>!1),a=!1;for(let c=0;c<s;c++)(0,hs.Xf)(n[c]).subscribe((0,xt.x)(i,h=>{r[c]=h,!a&&!o[c]&&(o[c]=!0,(a=o.every(Ha.y))&&(o=null))},ja.Z));e.subscribe((0,xt.x)(i,c=>{if(a){const h=[c,...r];i.next(t?t(...h):h)}}))})}(t),(0,oe.U)(([s,r])=>{const o=s.lastKeyToLoad,a=r.map(c=>c.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),function qa(n){return(0,us.e)((t,e)=>{let i=!1,s=0;t.subscribe((0,xt.x)(e,r=>(i||(i=!n(r,s++)))&&e.next(r)))})}(s=>-1===s.loadedKeys.indexOf(s.lastKeyToLoad)),(0,oe.U)(s=>s.actions))}(n,Do(n,t).pipe((0,cs.R)((s,r)=>[...s,r],[])),e)}(n,s,e).pipe(se.iC),valueChanges:(s,r)=>xo(n,s,e).pipe((0,oe.U)(a=>a.map(c=>r&&r.idField?{...c.payload.val(),[r.idField]:c.key}:c.payload.val())),se.iC)}}(r,this)}object(e){return function td(n,t){return{query:n,snapshotChanges:()=>Oo(n,t.schedulers.outsideAngular)().pipe(se.iC),update:e=>n.ref.update(e),set:e=>n.ref.set(e),remove:()=>n.ref.remove(),valueChanges:()=>Oo(n,t.schedulers.outsideAngular)().pipe(se.iC,(0,oe.U)(i=>i.payload.exists()?i.payload.val():null))}}(this.schedulers.ngZone.runOutsideAngular(()=>Ao(this.database,e)),this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(i){return new(i||n)(l.LFG(Mt.Dh),l.LFG(Mt.xv,8),l.LFG(nd,8),l.LFG(l.Lbi),l.LFG(l.R0b),l.LFG(se.HU),l.LFG(id,8),l.LFG(re.zQ,8),l.LFG(re.Qv,8),l.LFG(re.L6,8),l.LFG(re._Q,8),l.LFG(re.rT,8),l.LFG(re.lh,8),l.LFG(re.f7,8),l.LFG(se.Rf,8))};static \u0275prov=l.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Ro=(()=>{class n{constructor(e,i){this.http=e,this.db=i}getMatchs(){return this.db.object("/matchs").valueChanges()}updateMatches(e){this.db.object("/matchs").set(e).then(()=>{console.log("Donn\xe9es mises \xe0 jour avec succ\xe8s !")}).catch(s=>{console.error("Erreur lors de la mise \xe0 jour des donn\xe9es : ",s)})}handleError(e="operation",i){return s=>(console.error(`${e} failed: ${s.message}`),(0,as.of)(i))}static#e=this.\u0275fac=function(i){return new(i||n)(l.LFG(ls.eN),l.LFG(Po))};static#t=this.\u0275prov=l.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var ko=function(n){return n.A="Anthony",n.P="Pierre",n}(ko||{});y(2459),y(7453),y(7400),y(2714);let Vo=(()=>{class n{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static#e=this.\u0275fac=function(i){return new(i||n)(l.Y36(l.Qsj),l.Y36(l.SBq))};static#t=this.\u0275dir=l.lG2({type:n})}return n})(),Re=(()=>{class n extends Vo{static#e=this.\u0275fac=function(){let e;return function(s){return(e||(e=l.n5z(n)))(s||n)}}();static#t=this.\u0275dir=l.lG2({type:n,features:[l.qOj]})}return n})();const X=new l.OlP("NgValueAccessor"),ze=new l.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>Cn}),Cn="always";let Ea=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=l.oAB({type:n});static#n=this.\u0275inj=l.cJS({})}return n})();const Zi=new l.OlP("NgModelWithFormControlWarning"),Yd={provide:X,useExisting:(0,l.Gpc)(()=>ts),multi:!0};function Da(n,t){return null==n?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${n}: ${t}`.slice(0,50))}let ts=(()=>{class n extends Re{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;const s=Da(this._getOptionId(e),e);this.setProperty("value",s)}registerOnChange(e){this.onChange=i=>{this.value=this._getOptionValue(i),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),e))return i;return null}_getOptionValue(e){const i=function qd(n){return n.split(":")[0]}(e);return this._optionMap.has(i)?this._optionMap.get(i):e}static#e=this.\u0275fac=function(){let e;return function(s){return(e||(e=l.n5z(n)))(s||n)}}();static#t=this.\u0275dir=l.lG2({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,s){1&i&&l.NdJ("change",function(o){return s.onChange(o.target.value)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[l._Bn([Yd]),l.qOj]})}return n})(),Na=(()=>{class n{constructor(e,i,s){this._element=e,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(Da(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(i){return new(i||n)(l.Y36(l.SBq),l.Y36(l.Qsj),l.Y36(ts,9))};static#t=this.\u0275dir=l.lG2({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return n})();const Qd={provide:X,useExisting:(0,l.Gpc)(()=>ns),multi:!0};function Ma(n,t){return null==n?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${n}: ${t}`.slice(0,50))}let ns=(()=>{class n extends Re{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){let i;if(this.value=e,Array.isArray(e)){const s=e.map(r=>this._getOptionId(r));i=(r,o)=>{r._setSelected(s.indexOf(o.toString())>-1)}}else i=(s,r)=>{s._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(e){this.onChange=i=>{const s=[],r=i.selectedOptions;if(void 0!==r){const o=r;for(let a=0;a<o.length;a++){const h=this._getOptionValue(o[a].value);s.push(h)}}else{const o=i.options;for(let a=0;a<o.length;a++){const c=o[a];if(c.selected){const h=this._getOptionValue(c.value);s.push(h)}}}this.value=s,e(s)}}_registerOption(e){const i=(this._idCounter++).toString();return this._optionMap.set(i,e),i}_getOptionId(e){for(const i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,e))return i;return null}_getOptionValue(e){const i=function $d(n){return n.split(":")[0]}(e);return this._optionMap.has(i)?this._optionMap.get(i)._value:e}static#e=this.\u0275fac=function(){let e;return function(s){return(e||(e=l.n5z(n)))(s||n)}}();static#t=this.\u0275dir=l.lG2({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,s){1&i&&l.NdJ("change",function(o){return s.onChange(o.target)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[l._Bn([Qd]),l.qOj]})}return n})(),xa=(()=>{class n{constructor(e,i,s){this._element=e,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(Ma(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(Ma(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(i){return new(i||n)(l.Y36(l.SBq),l.Y36(l.Qsj),l.Y36(ns,9))};static#t=this.\u0275dir=l.lG2({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return n})(),sf=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=l.oAB({type:n});static#n=this.\u0275inj=l.cJS({imports:[Ea]})}return n})(),of=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:Zi,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:ze,useValue:e.callSetDisabledState??Cn}]}}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=l.oAB({type:n});static#n=this.\u0275inj=l.cJS({imports:[sf]})}return n})(),af=(()=>{class n{constructor(){this.winnerSelected=new l.vpe}selectWinner(e){const i=e.target.value;let s="";""!==i&&(s=i==this.match?.team1.id?this.match?.team1:this.match?.team2),this.winnerSelected.emit(s)}getPlayerName(e){return ko[e]}static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275cmp=l.Xpm({type:n,selectors:[["app-match"]],inputs:{match:"match"},outputs:{winnerSelected:"winnerSelected"},decls:23,vars:11,consts:[[1,"container"],[1,"card"],[1,"card-body"],[1,"row"],[1,"col-sm-12","col-md-6"],[1,"form-group"],["for","winnerSelect"],["id","winnerSelect",1,"form-control",3,"change"],["value","",3,"selected"],[3,"value","selected"]],template:function(i,s){1&i&&(l.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h6"),l._uU(6),l.qZA(),l.TgZ(7,"p"),l._uU(8),l.qZA()(),l.TgZ(9,"div",4)(10,"h6"),l._uU(11),l.qZA(),l.TgZ(12,"p"),l._uU(13),l.qZA()()(),l.TgZ(14,"div",5)(15,"label",6),l._uU(16,"S\xe9lectionner le gagnant"),l.qZA(),l.TgZ(17,"select",7),l.NdJ("change",function(o){return s.selectWinner(o)}),l._UZ(18,"option",8),l.TgZ(19,"option",9),l._uU(20),l.qZA(),l.TgZ(21,"option",9),l._uU(22),l.qZA()()()()()()),2&i&&(l.xp6(6),l.Oqu(s.getPlayerName(s.match.team1.player)),l.xp6(2),l.Oqu(s.match.team1.name),l.xp6(3),l.Oqu(s.getPlayerName(s.match.team2.player)),l.xp6(2),l.Oqu(s.match.team2.name),l.xp6(5),l.Q6J("selected",void 0===s.match.winner),l.xp6(1),l.s9C("value",s.match.team1.id),l.Q6J("selected",(null==s.match.winner?null:s.match.winner.id)===s.match.team1.id),l.xp6(1),l.Oqu(s.match.team1.name),l.xp6(1),l.s9C("value",s.match.team2.id),l.Q6J("selected",(null==s.match.winner?null:s.match.winner.id)===s.match.team2.id),l.xp6(1),l.Oqu(s.match.team2.name))},dependencies:[Na,xa],styles:[".card[_ngcontent-%COMP%]{width:30em;margin:10px auto 0;box-shadow:0 4px 8px #0003}.card-body[_ngcontent-%COMP%]{padding:20px}.card-title[_ngcontent-%COMP%]{text-align:center}.form-group[_ngcontent-%COMP%]{margin-top:20px}.form-control[_ngcontent-%COMP%]{width:100%}.col[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.col[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-bottom:10px}"]})}return n})();function lf(n,t){if(1&n){const e=l.EpF();l.TgZ(0,"div")(1,"app-match",2),l.NdJ("winnerSelected",function(s){const o=l.CHM(e).index,a=l.oxw();return l.KtG(a.updateWinner(o,s))}),l.qZA()()}if(2&n){const e=t.$implicit;l.xp6(1),l.Q6J("match",e)}}let cf=(()=>{class n{constructor(e){this.calendarService=e,this.matchs=[],this.destroyed$=new rs.x}ngOnInit(){this.calendarService.getMatchs().pipe((0,os.R)(this.destroyed$)).subscribe(e=>{this.matchs=e})}updateWinner(e,i){this.matchs[e].winner=i,this.calendarService.updateMatches(this.matchs)}ngOnDestroy(){this.destroyed$.next(!0),this.destroyed$.complete()}static#e=this.\u0275fac=function(i){return new(i||n)(l.Y36(Ro))};static#t=this.\u0275cmp=l.Xpm({type:n,selectors:[["app-calendar"]],decls:2,vars:1,consts:[[1,"mainDiv"],[4,"ngFor","ngForOf"],[3,"match","winnerSelected"]],template:function(i,s){1&i&&(l.TgZ(0,"div",0),l.YNc(1,lf,2,1,"div",1),l.qZA()),2&i&&(l.xp6(1),l.Q6J("ngForOf",s.matchs))},dependencies:[we.sg,af],styles:[".mainDiv[_ngcontent-%COMP%]{display:flex;height:calc(100vh - 105px);overflow-y:auto;flex-direction:column;align-items:center}"]})}return n})();var uf=y(5619);let hf=(()=>{class n{constructor(e){this.db=e}getTeams(){return this.db.object("/teams").valueChanges()}static#e=this.\u0275fac=function(i){return new(i||n)(l.LFG(Po))};static#t=this.\u0275prov=l.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),df=(()=>{class n{constructor(e,i){this.teamsService=e,this.calendarService=i,this._currentClassement=new uf.X(null),this.currentClassement$=this._currentClassement.asObservable()}getClassement(){return this.teamsService.getTeams().pipe((0,fs.w)(e=>this.calendarService.getMatchs().pipe((0,oe.U)(i=>{const s=[];return e.forEach(r=>{const o=i.filter(c=>(c.team1.id===r.id||c.team2.id===r.id)&&null!=c.winner?.id).length,a=i.filter(c=>c.winner?.id===r.id).length;s.push({team:r,nbPlayed:o,nbVictory:a})}),s.sort((r,o)=>o.nbVictory-r.nbVictory),s}))))}setCurrentClassement(e){this._currentClassement.next(e)}static#e=this.\u0275fac=function(i){return new(i||n)(l.LFG(hf),l.LFG(Ro))};static#t=this.\u0275prov=l.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ff(n,t){if(1&n&&(l.TgZ(0,"div",9)(1,"div",6),l._uU(2),l.qZA(),l.TgZ(3,"div",10),l._uU(4),l.qZA(),l.TgZ(5,"div",6),l._uU(6),l.qZA(),l.TgZ(7,"div",6),l._uU(8),l.qZA()()),2&n){const e=t.$implicit,i=t.index;l.xp6(2),l.hij(" ",i+1,""),l.xp6(2),l.Oqu(e.team.name),l.xp6(2),l.Oqu(e.nbPlayed),l.xp6(2),l.Oqu(e.nbVictory)}}function pf(n,t){if(1&n&&(l.TgZ(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),l._uU(5,"#"),l.qZA(),l.TgZ(6,"div",7),l._uU(7,"Deck"),l.qZA(),l.TgZ(8,"div",6),l._uU(9,"P"),l.qZA(),l.TgZ(10,"div",6),l._uU(11,"V"),l.qZA()(),l.YNc(12,ff,9,4,"div",8),l.qZA()()()),2&n){const e=t.ngIf;l.xp6(12),l.Q6J("ngForOf",e)}}function _f(n,t){}const gf=[{path:"",component:Ua,children:[{path:"calendar",component:cf},{path:"classement",component:(()=>{class n{constructor(e){this.classementService=e,this.destroyed$=new rs.x}ngOnInit(){this.classementService.getClassement().pipe((0,os.R)(this.destroyed$)).subscribe(e=>{console.log("Classement:",e),this.classementService.setCurrentClassement(e)})}get currentClassement(){return this.classementService.currentClassement$}ngOnDestroy(){this.destroyed$.next(!0),this.destroyed$.complete()}static#e=this.\u0275fac=function(i){return new(i||n)(l.Y36(df))};static#t=this.\u0275cmp=l.Xpm({type:n,selectors:[["app-classement"]],decls:4,vars:4,consts:[["class","mainDiv",4,"ngIf","ngIfElse"],["empty",""],[1,"mainDiv"],[1,"container","mt-5"],[1,"table-container"],[1,"table-header"],[2,"max-width","40px !important"],[2,"width","100px !important"],["class","table-row",4,"ngFor","ngForOf"],[1,"table-row"],[2,"width","100px !important","text-align","left !important"]],template:function(i,s){if(1&i&&(l.YNc(0,pf,13,1,"div",0),l.ALo(1,"async"),l.YNc(2,_f,0,0,"ng-template",null,1,l.W1O)),2&i){const r=l.MAs(3);l.Q6J("ngIf",l.lcZ(1,2,s.currentClassement))("ngIfElse",r)}},dependencies:[we.sg,we.O5,we.Ov],styles:['@charset "UTF-8";.table-container[_ngcontent-%COMP%]{width:100%;overflow-x:auto}.container[_ngcontent-%COMP%]{max-width:400px}.table-header[_ngcontent-%COMP%]{display:flex;background-color:#f2f2f2;font-weight:700}.table-row[_ngcontent-%COMP%]{display:flex;border-bottom:1px solid #ddd}.table-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%], .table-header[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1;padding:6px;box-sizing:border-box;text-align:center}.table-row[_ngcontent-%COMP%]:nth-child(odd){background-color:#f9f9f9}.empty-message[_ngcontent-%COMP%]{padding:10px}.mainDiv[_ngcontent-%COMP%]{display:flex;height:calc(100vh - 105px);overflow-y:auto;flex-direction:column;align-items:center}']})}return n})()}]},{path:"**",redirectTo:"/"}];let mf=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=l.oAB({type:n});static#n=this.\u0275inj=l.cJS({imports:[An.Bz.forChild(gf),An.Bz]})}return n})(),yf=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=l.oAB({type:n});static#n=this.\u0275inj=l.cJS({imports:[ls.JF,we.ez,mf,of]})}return n})()}}]);